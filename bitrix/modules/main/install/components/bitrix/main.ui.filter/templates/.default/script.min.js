this.BX=this.BX||{};(function(t,e){"use strict";(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["date-group"]=function(t){var e,i,s,n,a;e={block:"main-ui-control-field-group",name:t.name+"_datesel",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:"","data-time":t.enableTime},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){n={block:"main-ui-control-field-label",tag:"span",attrs:{title:t.label},content:t.label};e.content.push(n)}i={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:"value"in t?t.value:"",items:"items"in t?t.items:"",name:"name"in t?t.name+"_datesel":"",params:"params"in t?t.params:"",valueDelete:false}};e.content.push(i);if("content"in t&&BX.type.isArray(t.content)){t.content.forEach(function(t){e.content.push(t)})}if("content"in t&&(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content))){e.content.push(t.content)}s={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};e.content.push(s);if(!("dragButton"in t)||t.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};e.content.push(a)}return e}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-field"]=function(t){var e,i,s,n,a;e={block:"main-ui-control-field",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:""},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){n={block:"main-ui-control-field-label",tag:"span",attrs:{title:t.label},content:t.label};e.content.push(n)}if(BX.type.isArray(t.content)){t.content.forEach(function(t){e.content.push(t)})}else if(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content)){e.content.push(t.content)}if("valueDelete"in t&&t.valueDelete===true){s={block:"main-ui-control-value-delete",content:{block:"main-ui-control-value-delete-item",tag:"span"}};e.content.push(s)}if("deleteButton"in t&&t.deleteButton===true){i={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};e.content.push(i)}if(!("dragButton"in t)||t.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};e.content.push(a)}return e}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-field-group"]=function(t){var e,i,s,n;e={block:"main-ui-control-field-group",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:""},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){s={block:"main-ui-control-field-label",tag:"span",attrs:{title:t.label},content:t.label};e.content.push(s)}if(BX.type.isArray(t.content)){t.content.forEach(function(t){e.content.push(t)})}else if(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content)){e.content.push(t.content)}if("deleteButton"in t&&t.deleteButton===true){i={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};e.content.push(i)}if(!("dragButton"in t)||t.dragButton!==false){n={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};e.content.push(n)}return e}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-string"]=function(t){return{block:"main-ui-control-string",mix:["main-ui-control"],tag:"input",attrs:{type:"type"in t?t.type:"text",name:"name"in t?t.name:"",placeholder:"placeholder"in t?t.placeholder:"",tabindex:"tabindex"in t?t.tabindex:"",value:"value"in t?t.value:""}}}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-textarea"]=function(t){return{block:"main-ui-control-string",mix:["main-ui-control main-ui-control-textarea"],tag:"textarea",attrs:{name:"name"in t?t.name:"",placeholder:"placeholder"in t?t.placeholder:"",tabindex:"tabindex"in t?t.tabindex:""},content:"value"in t?t.value:""}}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-filter-field-list-item"]=function(t){var e={block:"main-ui-select-inner-label",content:"label"in t?t.label:""};var i={block:"main-ui-filter-field-list-item",mix:"main-ui-select-inner-item",attrs:{"data-id":t.id,"data-name":t.name,"data-item":"item"in t?JSON.stringify(t.item):{}},events:{click:"onClick"in t?t.onClick:""},content:e};return i}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-filter-info"]=function(t){return{block:"main-ui-filter-info",tag:"span",content:t.content,attrs:{title:t.title}}}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-number"]=function(t){var e,i,s;e={block:"main-ui-number",mix:["main-ui-control"],content:[]};if("mix"in t&&BX.type.isArray(t.mix)){t.mix.forEach(function(t){e.mix.push(t)})}i={block:"main-ui-number-input",mix:["main-ui-control-input"],tag:"input",attrs:{type:"number",name:"name"in t?t.name:"",tabindex:"tabindex"in t?t.tabindex:"",value:"value"in t?t.value:"",placeholder:"placeholder"in t?t.placeholder:"",autocomplete:"off"}};e.content.push(i);if("valueDelete"in t&&t.valueDelete===true){s={block:"main-ui-control-value-delete",content:{block:"main-ui-control-value-delete-item",tag:"span"}};e.content.push(s)}return e}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-search-square"]=function(t){var e=["main-ui-filter-search-square"];if("isPreset"in t&&t.isPreset){e.push("main-ui-filter-search-square-preset")}return{block:"main-ui-square",mix:e,attrs:{"data-item":"item"in t?JSON.stringify(t.item):"",title:"title"in t?t.title:""},content:[{block:"main-ui-square-item",content:"name"in t?BX.util.htmlspecialcharsback(t.name):""},{block:"main-ui-square-delete",mix:["main-ui-item-icon"]}]}}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["number-group"]=function(t){var e,i,s,n,a;e={block:"main-ui-control-field-group",name:"name"in t?t.name+"_numsel":"",mix:"mix"in t?t.mix:null,attrs:{"data-type":"type"in t?t.type:"","data-name":"name"in t?t.name:""},content:[]};if("label"in t&&BX.type.isNotEmptyString(t.label)){n={block:"main-ui-control-field-label",tag:"span",attrs:{title:t.label},content:t.label};e.content.push(n)}i={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:"value"in t?t.value:"",items:"items"in t?t.items:"",name:"name"in t?t.name+"_numsel":"",params:"params"in t?t.params:"",valueDelete:false}};e.content.push(i);if("content"in t&&BX.type.isArray(t.content)){t.content.forEach(function(t){e.content.push(t)})}if("content"in t&&(BX.type.isPlainObject(t.content)||BX.type.isNotEmptyString(t.content))){e.content.push(t.content)}s={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in t&&t.deleteTitle?t.deleteTitle:""}}};e.content.push(s);if(!("dragButton"in t)||t.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}};e.content.push(a)}return e}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["sidebar-item"]=function(t){return{block:"main-ui-filter-sidebar-item"+("pinned"in t&&t.pinned?" main-ui-item-pin":""),attrs:{"data-id":"id"in t?t.id:""},content:[{block:"main-ui-filter-icon-grab",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"dragTitle"in t&&t.dragTitle?t.dragTitle:""}},{block:"main-ui-filter-sidebar-item-text-container",tag:"span",content:[{block:"main-ui-filter-sidebar-item-input",tag:"input",attrs:{type:"text",placeholder:"placeholder"in t?t.placeholder:"",value:"text"in t?BX.util.htmlspecialchars(BX.util.htmlspecialcharsback(t.text)):""}},{block:"main-ui-filter-sidebar-item-text",tag:"span",content:"text"in t?t.text:""},{block:"main-ui-filter-icon-pin",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"noEditPinTitle"in t&&t.noEditPinTitle?t.noEditPinTitle:""}}]},{block:"main-ui-filter-icon-edit",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"editNameTitle"in t&&t.editNameTitle?t.editNameTitle:""}},{block:"main-ui-delete",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"removeTitle"in t&&t.removeTitle?t.removeTitle:""}},{block:"main-ui-filter-icon-pin",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"editPinTitle"in t&&t.editPinTitle?t.editPinTitle:""}},{block:"main-ui-filter-edit-mask"}]}}})();(function(){BX.namespace("BX.Filter");BX.Filter.Utils={cache:{},styleForEach:function t(e,i){var s;i=BX.type.isPlainObject(i)?i:null;s=Object.keys(i);[].forEach.call(e||[],function(t){s.forEach(function(e){BX.style(t,e,i[e])})})},closestParent:function t(e,i){if(e){if(!i){return e.parentNode||null}else{return BX.findParent(e,{className:i})}}},closestChilds:function t(e){return!!e?e.children:null},getNext:function t(e){return!!e?e.nextElementSibling:null},getPrev:function t(e){return!!e?e.previousElementSibling:null},collectionSort:function t(e,i){var s,n,a,r,l;if(e&&i&&e!==i&&e.parentNode===i.parentNode){s=this.closestParent(i);n=this.closestChilds(s);a=n.length;r=this.getIndex(n,e);l=this.getIndex(n,i);if(a===l){s.appendChild(i)}if(r>l){s.insertBefore(e,i)}if(r<l&&a!==l){s.insertBefore(e,this.getNext(i))}}},getIndex:function t(e,i){return[].indexOf.call(e||[],i)},getByClass:function t(e,i,s){var n=[];if(i){n=(e||document.body).getElementsByClassName(i);if(!s){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function t(e,i,s){var n=[];if(i){n=(e||document.body).getElementsByTagName(i);if(!s){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function t(e,i,s){var n=[];if(i){if(!s){n=(e||document.body).querySelector(i)}else{n=(e||document.body).querySelectorAll(i);n=[].slice.call(n)}}return n},requestAnimationFrame:function t(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};e.apply(window,arguments)},sortObject:function t(e){var i={};Object.keys(e).sort().forEach(function(t){i[t]=e[t]});return i},objectsIsEquals:function t(e,i){return JSON.stringify(e)===JSON.stringify(i)},isKey:function t(e,i){var s={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"escape",32:"space",37:"leftArrow",38:"upArrow",39:"rightArrow",40:"downArrow",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",65:"a"};var n=!!e?"keyCode"in e?e.keyCode:"which"in e?e.which:0:0;return n in s&&s[n]===i}}})();(function(){BX.namespace("BX.Filter");BX.Filter.DestinationSelectorManager={fields:[],controls:{},onSelect:function t(e,i,s){if(!BX.type.isNotEmptyObject(s)||!BX.type.isNotEmptyObject(s.item)||!BX.type.isNotEmptyString(s.selectorId)){return}var n=s.selectorId,a=s.item;var r=BX.Filter.DestinationSelectorManager.controls[n];if(r){var l=a.id;if(BX.type.isNotEmptyString(e)&&e=="Y"&&BX.type.isNotEmptyString(i)){var o=new RegExp("^"+i+"(\\d+)$");var u=l.match(o);if(BX.type.isArray(u)){l=u[1]}}else{var c={};BX.onCustomEvent(window,"BX.Filter.DestinationSelector:convert",[{selectorId:n,value:l},c]);if(BX.type.isNotEmptyString(c.value)){l=c.value}}r.setData(BX.util.htmlspecialcharsback(a.name),l);r.getLabelNode().value="";r.getLabelNode().blur()}},onDialogOpen:function t(e){if(typeof e=="undefined"||!BX.type.isNotEmptyString(e.selectorId)){return}var i=e.selectorId;var s=BX.Filter.DestinationSelector.items[i];if(s){s.onDialogOpen()}},onDialogClose:function t(e){if(typeof e=="undefined"||!BX.type.isNotEmptyString(e.selectorId)){return}var i=e.selectorId;var s=BX.Filter.DestinationSelector.items[i];if(s){s.onDialogClose()}}};BX.Filter.DestinationSelector=function(){this.id="";this.filterId="";this.settings={};this.fieldId="";this.control=null;this.inited=null};BX.Filter.DestinationSelector.items={};BX.Filter.DestinationSelector.create=function(t,e){if(typeof this.items[t]!="undefined"){return this.items[t]}var i=new BX.Filter.DestinationSelector(t,e);i.initialize(t,e);this.items[t]=i;BX.onCustomEvent(window,"BX.Filter.DestinationSelector:create",[t]);return i};BX.Filter.DestinationSelector.prototype.getSetting=function(t,e){return this.settings.hasOwnProperty(t)?this.settings[t]:e};BX.Filter.DestinationSelector.prototype.getSearchInput=function(){return this.control?this.control.getLabelNode():null};BX.Filter.DestinationSelector.prototype.initialize=function(t,e){this.id=t;this.settings=e?e:{};this.fieldId=this.getSetting("fieldId","");this.filterId=this.getSetting("filterId","");this.inited=false;this.opened=null;var i=this.getSetting("initialValue",false);if(!!i){var s={};s[this.fieldId]=i.itemId;s[this.fieldId+"_label"]=i.itemName;BX.Main.filterManager.getById(this.filterId).getApi().setFields(s)}BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this));BX.addCustomEvent(window,"BX.Main.Filter:onGetStopBlur",BX.delegate(this.onGetStopBlur,this));BX.addCustomEvent(window,"BX.Main.SelectorV2:beforeInitDialog",BX.delegate(this.onBeforeInitDialog,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityRemove",BX.delegate(this.onCustomEntityRemove,this))};BX.Filter.DestinationSelector.prototype.open=function(){var t=this.id;if(!this.inited){var e=this.getSearchInput();e.id=e.name;BX.addCustomEvent(window,"BX.Main.SelectorV2:afterInitDialog",BX.delegate(function(t){if(typeof t.id!="undefined"||t.id!=this.id){return}this.opened=true},this));BX.addCustomEvent(window,"BX.UI.SelectorManager:onCreate",BX.delegate(function(t){if(!BX.type.isNotEmptyString(t)||t!=this.id){return}BX.onCustomEvent(window,"BX.Filter.DestinationSelector:setSelected",[{selectorId:t,current:this.control.getCurrentValues()}])},this));BX.onCustomEvent(window,"BX.Filter.DestinationSelector:openInit",[{id:this.id,inputId:e.id,containerId:e.id}])}else{var i={};i[this.currentUser.entityId]="users";BX.onCustomEvent(window,"BX.Filter.DestinationSelector:open",[{id:this.id,bindNode:this.control.getField(),value:i}]);this.opened=true}};BX.Filter.DestinationSelector.prototype.close=function(){if(typeof BX.Main.selectorManagerV2.controls[this.id]!=="undefined"){BX.Main.selectorManagerV2.controls[this.id].closeDialog()}};BX.Filter.DestinationSelector.prototype.onCustomEntitySelectorOpen=function(t){var e=t.getId();if(this.fieldId!==e){this.control=null}else{this.control=t;if(this.control){var i=this.control.getCurrentValues();this.currentUser={entityId:i["value"]}}BX.Filter.DestinationSelectorManager.controls[this.id]=this.control;if(!this.opened){this.open()}else{this.close()}}};BX.Filter.DestinationSelector.prototype.onCustomEntitySelectorClose=function(t){if(this.fieldId===t.getId()&&this.inited===true&&this.opened===true){this.control=null;window.setTimeout(BX.delegate(this.close,this),0)}};BX.Filter.DestinationSelector.prototype.onGetStopBlur=function(t,e){if(BX.findParent(t.target,{className:"bx-lm-box"})){e.stopBlur=true}};BX.Filter.DestinationSelector.prototype.onCustomEntityRemove=function(t){if(this.fieldId===t.getId()){var e=BX.UI.SelectorManager.instances[t.getId()];if(e&&typeof t.hiddenInput!="undefined"&&typeof t.hiddenInput.value!="undefined"&&BX.type.isNotEmptyObject(e.itemsSelected)&&typeof e.itemsSelected[t.hiddenInput.value]!="undefined"){delete e.itemsSelected[t.hiddenInput.value]}}};BX.Filter.DestinationSelector.prototype.onBeforeInitDialog=function(t){if(typeof t.id=="undefined"||t.id!=this.id){return}this.inited=true;if(!this.control){t.blockInit=true}};BX.Filter.DestinationSelector.prototype.onDialogOpen=function(){this.opened=true};BX.Filter.DestinationSelector.prototype.onDialogClose=function(){this.opened=false}})();(function(){BX.namespace("BX.Filter");BX.Filter.FieldController=function(t,e){this.field=null;this.parent=null;this.type=null;this.input=null;this.deleteButton=null;this.init(t,e)};BX.Filter.FieldController.prototype={init:function t(e,i){if(!BX.type.isDomNode(e)){throw"BX.Filter.FieldController.init: field isn't dom node"}if(!(i instanceof BX.Main.Filter)){throw"BX.Filter.FieldController.init: parent not instance of BX.Main.ui.Filter"}this.field=e;this.parent=i;this.bind();this.isShowDelete()?this.showDelete():this.hideDelete()},isShowDelete:function t(){var e=this.getSquares();return this.getInputValue()||BX.type.isArray(e)&&e.length},getField:function t(){return this.field},getInput:function t(){var e,i;if(!BX.type.isDomNode(this.input)){e=this.getType();i=this.parent.types;if(e===i.DATE){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classDateInput)}if(e===i.NUMBER||e==="number"){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classNumberInput)}if(e===i.STRING){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classStringInput)}if(e===i.CUSTOM_ENTITY){this.input=BX.Filter.Utils.getBySelector(this.getField(),'input[type="hidden"]')}}return this.input},getDeleteButton:function t(){if(!BX.type.isDomNode(this.deleteButton)){this.deleteButton=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classValueDelete)}return this.deleteButton},getSquares:function t(){return BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classSquare)},bind:function t(){if(this.getType()!==this.parent.types.MULTI_SELECT&&this.getType()!==this.parent.types.SELECT){BX.bind(this.getDeleteButton(),"click",BX.delegate(this._onDeleteClick,this));BX.bind(this.getInput(),"input",BX.delegate(this._onInput,this))}},clearInput:function t(){var e=this.getInput();if(BX.type.isDomNode(e)){e.value=""}},hideDelete:function t(){var e=this.getDeleteButton();if(BX.type.isDomNode(e)){BX.addClass(e,this.parent.settings.classHide)}},showDelete:function t(){var e=this.getDeleteButton();if(BX.type.isDomNode(e)){BX.removeClass(e,this.parent.settings.classHide)}},removeSquares:function t(){var e=this.getSquares();if(BX.type.isArray(e)&&e.length){e.forEach(function(t){BX.remove(t)})}},_onDeleteClick:function t(){this.removeSquares();this.clearInput();this.hideDelete()},_onInput:function t(){this.getInputValue()?this.showDelete():this.hideDelete()},getInputValue:function t(){var e="";var i=this.getInput();if(BX.type.isDomNode(i)){e=i.value}return e},getType:function t(){if(!BX.type.isNotEmptyString(this.type)){this.type=BX.data(this.getField(),"type")}return this.type}}})();(function(){BX.namespace("BX.Main.ui");BX.Main.ui.CustomEntity=function(){this.field=null;this.labelInput=null;this.hiddenInput=null;this.popupContainer=null;this.inputClass="main-ui-control-string";this.squareClass="main-ui-square";this.multiple=null};BX.Main.ui.CustomEntity.isMultiple=function(t){if(!!t&&!BX.hasClass(t,"main-ui-control-entity")){t=BX.Filter.Utils.getByClass(t,"main-ui-control-entity")}return!!t&&JSON.parse(BX.data(t,"multiple"))};BX.Main.ui.CustomEntity.prototype={setField:function t(e){if(this.field!==e){this.field=e;this.reset()}},isMultiple:function t(){return BX.Main.ui.CustomEntity.isMultiple(this.getField())},reset:function t(){this.labelInput=null;this.hiddenInput=null},getField:function t(){return this.field},getId:function t(){var e=this.getHiddenNode();var i=null;if(BX.type.isDomNode(e)){i=e.name}return i},getLabelNode:function t(){if(!BX.type.isDomNode(this.labelInput)){this.labelInput=BX.Filter.Utils.getBySelector(this.getField(),"."+this.inputClass+'[type="text"]')}return this.labelInput},getHiddenNode:function t(){if(!BX.type.isDomNode(this.hiddenInput)){this.hiddenInput=BX.Filter.Utils.getBySelector(this.getField(),"."+this.inputClass+'[type="hidden"]')}return this.hiddenInput},getSquareByValue:function t(e){return BX.Filter.Utils.getBySelector(this.getField(),['[data-item*=":'+BX.util.jsencode(e)+'}"]','[data-item*=":\\"'+BX.util.jsencode(e)+'\\"}"]'].join(", "))},getSquares:function t(){return BX.Filter.Utils.getByClass(this.getField(),this.squareClass,true)},removeSquares:function t(){this.getSquares().forEach(BX.remove)},setSquare:function t(e,i){var s=this.getField();var n={block:"main-ui-square",name:e,item:{_label:e,_value:i}};var a=BX.decl(n);var r=this.getSquares();if(!r.length){BX.prepend(a,s)}else{BX.insertAfter(a,r[r.length-1])}},getCurrentValues:function t(){var e=this.getSquares();var i,s;if(this.isMultiple()){s=[];for(var n=0,a=e.length;n<a;n++){try{i=JSON.parse(BX.data(e[n],"item"));s.push({label:i._label,value:i._value})}catch(t){}}}else{if(e.length===0){s={label:"",value:""}}else{try{i=JSON.parse(BX.data(e[0],"item"));s={label:i._label,value:i._value}}catch(t){s={label:"",value:""}}}}return s},setData:function t(e,i){return this.isMultiple()?this.setMultipleData(e,i):this.setSingleData(e,i)},setSingleData:function t(e,i){var s=this.getHiddenNode();this.removeSquares();this.setSquare(e,i);if(BX.type.isDomNode(s)){s.value=i;BX.fireEvent(s,"input")}},setMultipleData:function t(e,i){var s=[];var n=this.getHiddenNode();if(BX.type.isArray(e)){this.removeSquares();if(BX.type.isArray(e)){e.forEach(function(t){s.push(t.value);this.setSquare(t.label,t.value)},this);if(BX.type.isDomNode(n)){n.value=JSON.stringify(s);BX.fireEvent(n,"input")}}}if(!BX.type.isArray(e)&&i!==null){if(!this.getSquareByValue(i)){this.setSquare(e,i);this.getSquares().forEach(function(t){var e=JSON.parse(BX.data(t,"item"));if(BX.type.isPlainObject(e)){s.push(e._value)}});n.value=JSON.stringify(s);BX.fireEvent(n,"input")}}},setPopupContainer:function t(e){if(BX.type.isDomNode(e)){this.popupContainer=e}},getPopupContainer:function t(){return this.popupContainer}}})();(function(){BX.namespace("BX.Filter");BX.Filter.Search=function(t){this.parent=null;this.container=null;this.input=null;this.preset=null;this.buttonsContainer=null;this.delay=800;this.timeout=null;this.init(t)};BX.Filter.Search.prototype={init:function t(e){this.parent=e;BX.bind(this.getInput(),"input",BX.delegate(this._onInputWithoutDebounce,this));if(this.parent.getParam("ENABLE_LIVE_SEARCH")){BX.bind(this.getInput(),"input",BX.debounce(this._onInput,this.delay,this))}BX.bind(this.getInput(),"keydown",BX.delegate(this._onKeyDown,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onSearchClick,this));BX.bind(this.getContainer(),"click",BX.delegate(this._onSearchContainerClick,this));this.removeAutofocus();this.firstInit=true},removeAutofocus:function t(){var e=this.getInput();if(!!e){e.blur();e.autofocus=null}},getFindButton:function t(){if(!BX.type.isDomNode(this.findButton)){this.findButton=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSearchButton)}return this.findButton},_onSearchClick:function t(){this.apply()},selectSquare:function t(e){!!e&&BX.addClass(e,this.parent.settings.classSquareSelected)},selectSquares:function t(){this.getSquares().forEach(this.selectSquare,this)},unselectSquare:function t(e){!!e&&BX.removeClass(e,this.parent.settings.classSquareSelected)},unselectSquares:function t(){this.getSquares().forEach(this.unselectSquare,this)},removeSquares:function t(){this.getSquares().forEach(this.removeSquare,this)},isSquaresSelected:function t(){var e=this.getSquares();return e.length&&e.every(this.isSquareSelected,this)},isSquareSelected:function t(e){return!!e&&BX.hasClass(e,this.parent.settings.classSquareSelected)},getLastSquare:function t(){var e=this.getSquares();return!!e?e[e.length-1]:null},isTextSelected:function t(){var e=this.getSearchString().length;var i=this.getInput();var s=i.selectionStart;var n=i.selectionEnd;return s===0&&n!==0&&n===e},isSelectionStart:function t(){var e=this.getInput();var i=e.selectionStart;var s=e.selectionEnd;return i===0&&s===0},isSquareRemoveButton:function t(e){return!!e&&BX.hasClass(e,this.parent.settings.classSquareDelete)},isClearButton:function t(e){return!!e&&BX.hasClass(e,this.parent.settings.classClearSearchValueButton)},getClearButton:function t(){return this.getContainer().querySelector("."+this.parent.settings.classClearSearchValueButton)},isSearchButton:function t(e){return!!e&&BX.hasClass(e,this.parent.settings.classSearchButton)},adjustFocus:function t(){if(!BX.browser.IsMobile()){var e=this.getInput();if(document.activeElement!==e&&window.scrollY<BX.pos(e).top){e.value=e.value;e.blur();e.focus()}}},findSquareByChild:function t(e){return BX.findParent(e,{className:this.parent.settings.classSquare},true,false)},getSquareData:function t(e){var i=BX.data(e,"item");return!!e&&!!i?JSON.parse(i):null},isSquareControl:function t(e){var i=this.getSquareData(e);return!!i&&(i.type==="control"||BX.type.isArray(i))},onPresetSquareRemove:function t(){var e=this.parent;var i=e.getPreset();var s=i.getCurrentPresetId();var n=e.getParam("RESET_TO_DEFAULT_MODE");var a=e.getParam("VALUE_REQUIRED");var r=i.isPinned(s);var l=this.getSquares();if(l.length===1){if(a&&r){this.parent.showPopup();this.adjustPlaceholder();this.parent.getPreset().deactivateAllPresets()}else{if(n&&r||!n){var o=true;this.lastPromise=e.resetFilter(o);e.closePopup()}}if(n&&!r){this.lastPromise=e.getPreset().applyPinnedPreset()}}if(l.length>1){var u=i.getPreset(i.getCurrentPresetId());var c=i.getPreset("tmp_filter");c.FIELDS=BX.clone(u.ADDITIONAL);u.ADDITIONAL=[];i.deactivateAllPresets();i.applyPreset("tmp_filter");e.applyFilter()}},onControlSquareRemove:function t(e){var i=this.parent;var s=i.getPreset();var n=i.getParam("RESET_TO_DEFAULT_MODE");var a=i.getParam("VALUE_REQUIRED");var r;if(n&&this.getSquares().length===1){if(a){r=this.getSquareData(e);i.clearControls(r);this.parent.showPopup();this.adjustPlaceholder();this.parent.getPreset().deactivateAllPresets()}else{this.lastPromise=i.getPreset().applyPinnedPreset()}}else{r=this.getSquareData(e);i.clearControls(r);i.closePopup();if(BX.type.isArray(r)){r.forEach(function(t){s.removeAdditionalField(t.name)})}if(BX.type.isPlainObject(r)){s.removeAdditionalField(r.name)}this.apply()}},onValueRequiredSquareRemove:function t(){var e=this.parent;e.getPreset().deactivateAllPresets();e.showPopup();this.adjustPlaceholder()},complexSquareRemove:function t(e){var i=this.parent.getParam("VALUE_REQUIRED_MODE");var s=!this.isSquareControl(e);if(i){this.onValueRequiredSquareRemove()}else{if(s){this.onPresetSquareRemove()}else{this.onControlSquareRemove(e)}}this.removeSquare(e);this.adjustClearButton()},adjustClearButton:function t(){!!this.getLastSquare()?this.showClearButton():this.hideClearButton()},removeSquare:function t(e){!!e&&BX.remove(e)},_onSearchContainerClick:function t(e){var i=this.parent;if(this.isClearButton(e.target)){if(!i.getParam("VALUE_REQUIRED")){if(!i.getParam("VALUE_REQUIRED_MODE")){if(i.getParam("RESET_TO_DEFAULT_MODE")){this.clearInput();this.lastPromise=i.getPreset().applyPinnedPreset()}else{i.resetFilter()}i.closePopup();this.adjustFocus()}else{this.removeSquares();i.showPopup();this.adjustPlaceholder();this.hideClearButton();i.getPreset().deactivateAllPresets()}}else{var s=i.getPreset().isPinned(i.getPreset().getCurrentPresetId());if(s||i.getPreset().getCurrentPresetId()==="tmp_filter"){var n=i.getPreset().getPreset(i.getPreset().getCurrentPresetId());if(n.ADDITIONAL.length){n.ADDITIONAL=[];this.lastPromise=i.getPreset().applyPreset(i.getPreset().getCurrentPresetId());this.apply()}else{this.removeSquares();i.showPopup();this.adjustPlaceholder();this.hideClearButton();i.getPreset().deactivateAllPresets()}}else{if(i.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=i.getPreset().applyPinnedPreset()}else{i.resetFilter()}i.closePopup();this.adjustFocus()}this.clearInput()}}else if(this.isSearchButton(e.target)){this.apply();this.adjustFocus()}else if(this.isSquareRemoveButton(e.target)){var a=this.findSquareByChild(e.target);this.complexSquareRemove(a);this.adjustFocus()}else{if(!i.getPopup().isShown()){i.showPopup()}else{var r=this.getInput();var l=r.selectionStart;var o=r.selectionEnd;var u=this.getSearchString().length;if(!(u&&l===0&&o===u)){if(i.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.lastPromise=i.getPreset().applyPinnedPreset()}else{i.closePopup()}}else{i.closePopup();if(i.getParam("VALUE_REQUIRED_MODE")){i.restoreRemovedPreset()}}}}}},_onKeyDown:function t(e){var i=BX.Filter.Utils;var s=this.parent;if(i.isKey(e,"enter")){if(s.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.parent.getPreset().applyPinnedPreset()}else{this.apply();this.firstInit=false;this.lastSearchString=this.getSearchString()}}else{this.apply();this.firstInit=false;this.lastSearchString=this.getSearchString()}s.closePopup()}if(i.isKey(e,"tab")||i.isKey(e,"downArrow")){s.showPopup();s.adjustFocus();this.unselectSquares()}if(i.isKey(e,"upArrow")){s.closePopup();if(s.getParam("VALUE_REQUIRED_MODE")){this.parent.restoreRemovedPreset()}if(s.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.parent.getPreset().applyPinnedPreset()}}}if(i.isKey(e,"a")&&e.metaKey||i.isKey(e,"a")&&e.ctrlKey){this.selectSquares()}if(i.isKey(e,"backspace")&&this.isTextSelected()&&this.isSquaresSelected()){clearTimeout(this.timeout);if(this.parent.getParam("VALUE_REQUIRED")){var n=this.parent.getPreset().isPinned(this.parent.getPreset().getCurrentPresetId());if(n){this.removeSquares();this.parent.showPopup();this.adjustPlaceholder();this.hideClearButton();this.parent.getPreset().deactivateAllPresets()}else{if(this.parent.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=this.parent.getPreset().applyPinnedPreset()}else{this.parent.resetFilter()}this.parent.closePopup();this.adjustFocus()}this.clearInput()}else{if(this.parent.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=this.parent.getPreset().applyPinnedPreset()}else{this.lastPromise=this.parent.resetFilter()}this.parent.closePopup()}}if(i.isKey(e,"backspace")&&this.isSelectionStart()){clearTimeout(this.timeout);var a=this.getLastSquare();this.isSquareSelected(a)?this.complexSquareRemove(a):this.selectSquare(a)}if(!i.isKey(e,"backspace")&&!e.metaKey&&this.isSquaresSelected()){this.unselectSquares()}},getSearchString:function t(){var e=this.getInput();return!!e?e.value:""},getSquares:function t(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare,true)},adjustPlaceholder:function t(){if(this.parent.getParam("LIMITS_ENABLED")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_LIMITS_EXCEEDED"))}else if(this.parent.getParam("DISABLE_SEARCH")||!this.parent.settings.get("SEARCH")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER"))}else{this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_DEFAULT"))}},isResolvedRequest:function t(){return!this.lastPromise||!!this.lastPromise&&this.lastPromise.state},apply:function t(){if(this.isResolvedRequest()){this.lastPromise=this.parent._onFindButtonClick()}return this.lastPromise},reset:function t(){if(this.isResolvedRequest()){this.parent.getSearch().removePreset();this.parent.getPreset().deactivateAllPresets();this.parent.getPreset().resetPreset(true);this.timeout=setTimeout(BX.delegate(function(){this.lastPromise=this.parent.resetFilter()},this),this.delay)}return this.lastPromise},_onInputWithoutDebounce:function t(){clearTimeout(this.timeout);var e=this.getSearchString();this.lastSearchString=!!this.lastSearchString?this.lastSearchString:e;if(e!==this.lastSearchString&&(!this.parent.isIe()||!this.firstInit)){if(this.parent.getParam("ENABLE_LIVE_SEARCH")){this.parent.showGridAnimation();BX.onCustomEvent(window,"BX.Filter.Search:input",[this.parent.params.FILTER_ID,e])}this.parent.getPopup().isShown()&&this.parent.closePopup()}if(e){this.showClearButton()}else{if(!this.getSquares().length&&this.lastSearchString!==e){this.hideClearButton();this.adjustPlaceholder()}}},_onInput:function t(){var e=this.getSearchString();if(e!==this.lastSearchString&&(!this.parent.isIe()||!this.firstInit)){this.apply()}this.firstInit=false;this.lastSearchString=e},getButtonsContainer:function t(){if(!BX.type.isDomNode(this.buttonsContainer)){this.buttonsContainer=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSearchButtonsContainer)}return this.buttonsContainer},showClearButton:function t(){BX.addClass(this.getButtonsContainer(),this.parent.settings.classShow)},hideClearButton:function t(){BX.removeClass(this.getButtonsContainer(),this.parent.settings.classShow)},getInput:function t(){var e;if(!BX.type.isDomNode(this.input)){e=[this.parent.getParam("FILTER_ID",""),"_search"].join("");this.input=BX(e)}return this.input},getContainer:function t(){var e;if(!BX.type.isDomNode(this.container)){e=[this.parent.getParam("FILTER_ID"),"_search_container"].join("");this.container=BX(e)}return this.container},setInputPlaceholder:function t(e){var i=this.getInput();i.placeholder=e},clearInput:function t(){var e=this.getInput();if(BX.type.isDomNode(e)){e.value=null}},clearForm:function t(){this.clearInput();this.removePreset()},makeSquares:function t(e,i,s){var n;var a=null;var r=this.getContainer();var l={squares:[],moreSquares:[]};e.forEach(function(t,e){if(e<i){n=BX.decl(t);a=a||n;if(!s){if(e===0){BX.prepend(n,r)}else{BX.insertAfter(n,a)}}else{var o=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare);if(o){BX.insertAfter(n,o)}else{BX.prepend(n,r)}}a=n;l.squares.push(n)}else{l.moreSquares.push({type:"control",name:t.value,title:t.title})}},this);return l},squares:function t(e,i,s){var n,a,r,l,o;var t=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare,true);if(s){t.forEach(function(t){var e=BX.data(t,"item");if(e){BX.remove(t)}})}else{t.forEach(BX.remove)}n=this.prepareSquaresData(e);a=this.makeSquares(n,i,s);l=0;o={squaresData:n,width:0};if(a.moreSquares.length){r={block:"main-ui-search-square",name:this.parent.getParam("MAIN_UI_FILTER__AND")+" "+this.parent.getParam("MAIN_UI_FILTER__MORE")+" "+a.moreSquares.length,item:a.moreSquares,title:a.moreSquares.map(function(t){return t.title}).join(", \n")};r=BX.decl(r);a.squares.push(r);BX.insertAfter(r,a.squares[a.squares.length-2]);l=a.squares.reduce(function(t,e){return t+BX.width(e)+(parseFloat(BX.style(e,"margin-right"))||0)},0)}o.width=l;return o},setPreset:function t(e){var i=this.getContainer();var s,n;var a;if(BX.type.isPlainObject(e)){n=BX.Filter.Utils.getByClass(i,this.parent.settings.classSquare,true);n.forEach(BX.remove);e=BX.clone(e);e.ADDITIONAL=e.ADDITIONAL||[];BX.onCustomEvent(window,"BX.Filter.Search:beforeSquaresUpdate",[e,this]);if(e.ID!=="default_filter"&&e.ID!=="tmp_filter"){s=BX.decl({block:"main-ui-search-square",name:e.TITLE,value:e.ID,isPreset:true});BX.prepend(s,i);if("ADDITIONAL"in e&&BX.type.isArray(e.ADDITIONAL)&&e.ADDITIONAL.length){a=this.squares(e.ADDITIONAL,1,true);if(BX.width(i)-a.width<100){a=this.squares(e.ADDITIONAL,0,true)}}}else{if("ADDITIONAL"in e&&BX.type.isArray(e.ADDITIONAL)&&e.ADDITIONAL.length){e.ADDITIONAL.forEach(function(t,i){if(!("ID"in t)){t.ID="ADDITIONAL_ID_"+i}if(!("NAME"in t)){t.NAME="ADDITIONAL_NAME_"+i}if(!("TYPE"in t)){t.TYPE="STRING"}if("LABEL"in t&&"LABEL"in t){e.FIELDS.push(t)}})}if(BX.type.isArray(e.FIELDS)&&e.FIELDS.length){a=this.squares(e.FIELDS,2);if(BX.width(i)-a.width<100){a=this.squares(e.FIELDS,1)}}}if(a&&BX.type.isArray(a.squaresData)&&a.squaresData.length||e.ID!=="default_filter"&&e.ID!=="tmp_filter"){if(this.parent.getParam("LIMITS_ENABLED")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_LIMITS_EXCEEDED"))}else{this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_WITH_FILTER"))}this.showClearButton()}else{this.adjustPlaceholder()}if(BX.type.isNotEmptyString(this.parent.getSearch().getInput().value)){this.showClearButton()}}},prepareSquaresData:function t(e){var i,s,n;var a=[];e=e.filter(function(t){return!!t});e.map(function(t){i=null;switch(t.TYPE){case this.parent.types.DATE:{i=t.LABEL+": "+t.SUB_TYPE.NAME;if(t.SUB_TYPE.VALUE===this.parent.dateTypes.QUARTER&&BX.type.isNotEmptyString(t.VALUES._quarter)){var e=t.QUARTERS.filter(function(e){return e.VALUE==t.VALUES._quarter}).map(function(t){return t.NAME});e=e.length?e.join(""):"";i=t.LABEL+": "+e+" "+this.parent.getParam("MAIN_UI_FILTER__QUARTER").toLocaleLowerCase()+" "+t.VALUES._year}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.YEAR&&BX.type.isNotEmptyString(t.VALUES._year)){i=t.LABEL+": "+t.VALUES._year}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.MONTH&&BX.type.isNotEmptyString(t.VALUES._month)){var r=t.MONTHS.filter(function(e){return e.VALUE==t.VALUES._month}).map(function(t){return t.NAME});r=r.length?r.join(""):"";i=t.LABEL+": "+r+" "+t.VALUES._year}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.EXACT&&BX.type.isNotEmptyString(t.VALUES._from)){i=t.LABEL+": "+t.VALUES._from}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.RANGE){if(BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){i=t.LABEL+": "+t.VALUES._from+"-"+t.VALUES._to}else if(!BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){i=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__BEFORE")+" "+t.VALUES._to}else if(BX.type.isNotEmptyString(t.VALUES._from)&&!BX.type.isNotEmptyString(t.VALUES._to)){i=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__AFTER")+" "+t.VALUES._from}}if((t.SUB_TYPE.VALUE===this.parent.dateTypes.NEXT_DAYS||t.SUB_TYPE.VALUE===this.parent.dateTypes.PREV_DAYS)&&!BX.type.isNumber(parseInt(t.VALUES._days))){i=null}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.NEXT_DAYS&&BX.type.isNumber(parseInt(t.VALUES._days))){i=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__DATE_NEXT_DAYS_LABEL").replace("#N#",t.VALUES._days)}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.PREV_DAYS&&BX.type.isNumber(parseInt(t.VALUES._days))){i=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__DATE_PREV_DAYS_LABEL").replace("#N#",t.VALUES._days)}if(t.SUB_TYPE.VALUE===this.parent.dateTypes.NONE){i=null}break}case this.parent.types.CUSTOM_DATE:{if(BX.type.isArray(t.VALUE.days)&&t.VALUE.days.length||BX.type.isArray(t.VALUE.months)&&t.VALUE.months.length||BX.type.isArray(t.VALUE.years)&&t.VALUE.years.length){i=t.LABEL}break}case this.parent.types.SELECT:{if(BX.type.isPlainObject(t.VALUE)&&t.VALUE.VALUE||t.STRICT){i=t.LABEL+": "+t.VALUE.NAME}break}case this.parent.types.MULTI_SELECT:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){s=[];i=t.LABEL+": ";t.VALUE.forEach(function(t,e){if(e<2){s.push(t.NAME)}});i+=s.join(", ");if(t.VALUE.length>2){n=[];t.VALUE.forEach(function(t){n.push(t.NAME)});i=n.join(", ")}}break}case this.parent.types.NUMBER:{if(t.SUB_TYPE.VALUE==="exact"){if(BX.type.isNotEmptyString(t.VALUES._from)){i=t.LABEL+": "+t.VALUES._from}else{i=null}}if(t.SUB_TYPE.VALUE==="range"){if(BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){i=t.LABEL+": "+t.VALUES._from+"-"+t.VALUES._to}else if(!BX.type.isNotEmptyString(t.VALUES._from)&&BX.type.isNotEmptyString(t.VALUES._to)){i=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__NUMBER_LESS")+" "+t.VALUES._to}else if(BX.type.isNotEmptyString(t.VALUES._from)&&!BX.type.isNotEmptyString(t.VALUES._to)){i=t.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__NUMBER_MORE")+" "+t.VALUES._from}else{i=null}}if(t.SUB_TYPE.VALUE==="more"){if(BX.type.isNotEmptyString(t.VALUES._from)){i=t.LABEL+": > ";i+=t.VALUES._from}}if(t.SUB_TYPE.VALUE==="less"){if(BX.type.isNotEmptyString(t.VALUES._to)){i=t.LABEL+": < ";i+=t.VALUES._to}}break}case this.parent.types.CUSTOM_ENTITY:case this.parent.types.DEST_SELECTOR:{if(t.MULTIPLE){var l=!!t.VALUES._label?t.VALUES._label:[];if(BX.type.isPlainObject(l)){l=Object.keys(l).map(function(t){return l[t]})}if(!BX.type.isArray(l)){l=[l]}if(l.length>0){i=t.LABEL+": ";i+=l.join(", ")}}else{if(BX.type.isNotEmptyString(t.VALUES._value)&&BX.type.isNotEmptyString(t.VALUES._label)){i=t.LABEL+": ";i+=t.VALUES._label}}break}case this.parent.types.CUSTOM:{i="_VALUE"in t&&BX.type.isNotEmptyString(t._VALUE)?t.LABEL:null;break}default:{if(BX.type.isNotEmptyString(t.VALUE)){i=t.LABEL+": "+t.VALUE}break}}if(i!==null){a.push({block:"main-ui-search-square",name:i,value:t.NAME,item:{type:"control",name:t.NAME},title:i})}},this);return a},getPreset:function t(){var e=this.getContainer();var i=this.parent.settings.classSquare;var s=null;if(BX.type.isDomNode(e)){s=BX.Filter.Utils.getByClass(e,i)}return s},removePreset:function t(){var e=this.getPreset();if(BX.type.isDomNode(e)){BX.remove(e);this.adjustPlaceholder()}this.hideClearButton()},updatePreset:function t(e){this.removePreset();this.setPreset(e)}}})();(function(){BX.namespace("BX.Filter");BX.Filter.Settings=function(t,e){this.classField="main-ui-control-field";this.classFieldGroup="main-ui-control-field-group";this.classFieldLine="main-ui-filter-field-line";this.classFieldDelete="main-ui-filter-field-delete";this.classFieldLabel="main-ui-control-field-label";this.classFieldWithLabel="main-ui-filter-wield-with-label";this.classPresetName="main-ui-filter-sidebar-item-text";this.classControl="main-ui-control";this.classDateInput="main-ui-date-input";this.classHide="main-ui-hide";this.classNumberInput="main-ui-number-input";this.classSelect="main-ui-select";this.classMultiSelect="main-ui-multi-select";this.classValueDelete="main-ui-control-value-delete";this.classStringInput="main-ui-control-string";this.classAddField="main-ui-filter-field-add-item";this.classAddPresetField="main-ui-filter-new-filter";this.classAddPresetFieldInput="main-ui-filter-sidebar-edit-control";this.classAddPresetButton="main-ui-filter-add-item";this.classButtonsContainer="main-ui-filter-field-button-container";this.classSaveButton="main-ui-filter-save";this.classCancelButton="main-ui-filter-cancel";this.classMenuItem="main-ui-select-inner-item";this.classMenuItemText="main-ui-select-inner-item-element";this.classMenuMultiItemText="main-ui-select-inner-label";this.classMenuItemChecked="main-ui-checked";this.classSearchContainer="main-ui-filter-search";this.classDefaultPopup="popup-window";this.classPopupFieldList="main-ui-filter-popup-field-list";this.classPopupFieldList1Column="main-ui-filter-field-list-1-column";this.classPopupFieldList2Column="main-ui-filter-field-list-2-column";this.classPopupFieldList3Column="main-ui-filter-field-list-3-column";this.classFieldListItem="main-ui-filter-field-list-item";this.classEditButton="main-ui-filter-add-edit";this.classPresetEdit="main-ui-filter-edit";this.classPresetNameEdit="main-ui-filter-edit-text";this.classPresetDeleteButton="main-ui-delete";this.classPresetDragButton="main-ui-filter-icon-grab";this.classPresetEditButton="main-ui-filter-icon-edit";this.classPresetEditInput="main-ui-filter-sidebar-item-input";this.classPresetOndrag="main-ui-filter-sidebar-item-ondrag";this.classSquare="main-ui-square";this.classSquareDelete="main-ui-square-delete";this.classSquareSelected="main-ui-square-selected";this.classPresetsContainer="main-ui-filter-sidebar-item-container";this.classPreset="main-ui-filter-sidebar-item";this.classPresetCurrent="main-ui-filter-current-item";this.classFilterContainer="main-ui-filter-wrapper";this.classFileldControlList="main-ui-filter-field-container-list";this.classRestoreFieldsButton="main-ui-filter-field-restore-items";this.classClearSearchValueButton="main-ui-delete";this.classSearchButtonsContainer="main-ui-item-icon-block";this.classSearchButton="main-ui-search";this.classDisabled="main-ui-disable";this.classAnimationShow="main-ui-popup-show-animation";this.classAnimationClose="main-ui-popup-close-animation";this.classLimitsAnimation="main-ui-filter-field-limits-animate";this.classSidebarControlsContainer="main-ui-filter-add-container";this.searchContainerPostfix="_search_container";this.classPresetButtonsContainer="main-ui-filter-field-preset-button-container";this.classFindButton="main-ui-filter-find";this.classResetButton="main-ui-filter-reset";this.classDefaultFilter="main-ui-filter-default-preset";this.classRestoreButton="main-ui-filter-reset-link";this.classPinButton="main-ui-filter-icon-pin";this.classPopupOverlay="popup-window-overlay";this.classPinnedPreset="main-ui-item-pin";this.classWaitButtonClass="ui-btn-clock";this.classForAllCheckbox="main-ui-filter-save-for-all";this.classShow="main-ui-show";this.classFocus="main-ui-focus";this.classPresetField="main-ui-filter-preset-field";this.numberPostfix="_numsel";this.datePostfix="_datesel";this.toPostfix="_to";this.fromPostfix="_from";this.daysPostfix="_days";this.monthPostfix="_month";this.quarterPostfix="_quarter";this.yearPostfix="_year";this.generalTemplateId="";this.init(t,e)};BX.Filter.Settings.prototype={init:function t(e,i){this.generalTemplateId=i.getParam("FILTER_ID")+"_GENERAL_template";this.mergeSettings(e)},get:function t(e,i){return e&&e in this&&!BX.type.isFunction(this[e])?this[e]:i},mergeSettings:function t(e){if(BX.type.isPlainObject(e)){Object.keys(e).forEach(function(t){if(!BX.type.isFunction(this[t])){this[t]=e[t]}},this)}}}})();(function(){BX.namespace("BX.Main");BX.Main.Filter=function(t,e,i,s,n,a){this.params=t;this.search=null;this.popup=null;this.presets=null;this.fields=null;this.types=i;this.dateTypes=s;this.additionalDateTypes=a;this.numberTypes=n;this.settings=new BX.Filter.Settings(e,this);this.filter=null;this.api=null;this.isAddPresetModeState=false;this.firstInit=true;this.emitter=new BX.Event.EventEmitter;this.init()};function t(t){if(BX.type.isString(t)){t=t.toLowerCase();t=t.replace(/[\-_\s]+(.)?/g,function(t,e){return e?e.toUpperCase():""});return t.substr(0,1).toLowerCase()+t.substr(1)}return t}BX.Main.Filter.prototype={init:function t(){BX.bind(document,"mousedown",BX.delegate(this._onDocumentClick,this));BX.bind(document,"keydown",BX.delegate(this._onDocumentKeydown,this));BX.bind(window,"load",BX.delegate(this.onWindowLoad,this));BX.addCustomEvent("Grid::ready",BX.delegate(this._onGridReady,this));this.getSearch().updatePreset(this.getParam("CURRENT_PRESET"))},getEmitter:function t(){return this.emitter},onWindowLoad:function t(){this.settings.get("AUTOFOCUS")&&this.adjustFocus()},clearGet:function t(){if("history"in window){var e=window.location.toString();var i=BX.util.remove_url_param(e,"apply_filter");window.history.replaceState(null,"",i)}},adjustFocus:function t(){this.getSearch().adjustFocus()},_onAddPresetKeydown:function t(e){if(BX.Filter.Utils.isKey(e,"enter")){this._onSaveButtonClick()}},_onDocumentKeydown:function t(e){if(BX.Filter.Utils.isKey(e,"escape")){if(this.getPopup().isShown()){BX.onCustomEvent(window,"BX.Main.Filter:blur",[this]);this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}if(this.getParam("VALUE_REQUIRED")){if(!this.getSearch().getSquares().length){this.getPreset().applyPinnedPreset()}}}}},getApi:function t(){if(!(this.api instanceof BX.Filter.Api)){this.api=new BX.Filter.Api(this)}return this.api},addSidebarItem:function t(e,i,s){var n=this.getPreset();var a=n.getContainer();var r=n.createSidebarItem(e,i,s);var l=n.getPresetNodeById(e);if(BX.type.isDomNode(l)){BX.remove(l);BX.prepend(r,a)}else{a&&a.insertBefore(r,n.getAddPresetField())}BX.bind(r,"click",BX.delegate(n._onPresetClick,n))},saveUserSettings:function t(e){var i={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER_ARRAY"};var s=this.getPreset();var n=s.getCurrentPresetId();var a={};this.params["PRESETS"]=BX.clone(this.editablePresets);a.current_preset=n;s.getPresets().forEach(function(t,i){var n=s.getPresetId(t);if(n&&n!=="tmp_filter"){var r=s.getPreset(n);r.TITLE=BX.util.htmlspecialchars(BX.util.htmlspecialcharsback(r.TITLE));r.SORT=i;s.updatePresetName(t,r.TITLE);a[n]={sort:i,name:r.TITLE,fields:this.preparePresetSettingsFields(r.FIELDS),for_all:e&&!BX.type.isBoolean(r.FOR_ALL)||e&&r.FOR_ALL===true}}},this);this.saveOptions(a,i,null,e)},isForAll:function t(e){var i=this.getForAllCheckbox();return BX.type.isBoolean(e)&&e||!!i&&!!i.checked},getForAllCheckbox:function t(){if(!this.forAllCheckbox){this.forAllCheckbox=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.forAllCheckbox},preparePresetSettingsFields:function t(e){var i={};var s;(e||[]).forEach(function(t){switch(t.TYPE){case this.types.STRING:{i[t.NAME]=t.VALUE;break}case this.types.TEXTAREA:{i[t.NAME]=t.VALUE;break}case this.types.SELECT:{i[t.NAME]="VALUE"in t.VALUE?t.VALUE.VALUE:"";break}case this.types.MULTI_SELECT:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){t.VALUE.forEach(function(e,s){i[t.NAME]=BX.type.isPlainObject(i[t.NAME])?i[t.NAME]:{};i[t.NAME][s]=e.VALUE},this)}break}case this.types.CHECKBOX:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){t.VALUE.forEach(function(e,s){i[t.NAME]=BX.type.isPlainObject(i[t.NAME])?i[t.NAME]:{};i[t.NAME][s]=e.VALUE},this)}break}case this.types.DATE:{if(BX.type.isPlainObject(t.VALUES)){s=Object.keys(t.VALUES);i[t.NAME+"_datesel"]=t.SUB_TYPE.VALUE;s.forEach(function(e){i[t.NAME+e]=t.VALUES[e]},this)}break}case this.types.NUMBER:{if(BX.type.isPlainObject(t.VALUES)){s=Object.keys(t.VALUES);i[t.NAME+"_numsel"]=t.SUB_TYPE.VALUE;s.forEach(function(e){i[t.NAME+e]=t.VALUES[e]},this)}break}case this.types.DEST_SELECTOR:{if(BX.type.isPlainObject(t.VALUES)){i[t.NAME]=t.VALUES._value;i[t.NAME+"_label"]=t.VALUES._label}break}case this.types.CUSTOM_ENTITY:{if(BX.type.isPlainObject(t.VALUES)){i[t.NAME]=t.VALUES._value;i[t.NAME+"_label"]=t.VALUES._label}break}default:{break}}},this);return i},savePreset:function t(){var e="filter_"+ +new Date;var i=BX.util.htmlspecialcharsback(this.getPreset().getAddPresetFieldInput().value);this.updatePreset(e,i,null,true,null,null,true);this.addSidebarItem(e,i);this.getPreset().applyPreset(e);this.getPreset().activatePreset(e);this.applyFilter()},updatePreset:function t(e,i,s,n,a,r,l){var o=this.getFilterFieldsValues();var u=this.getPreset().getFields().map(function(t){return BX.data(t,"name")});var c=this.getPreset().getCurrentPresetData();var h={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var d,p,f,m,E;var g={};g.additional={};if(e!=="tmp_filter"&&e!=="default_filter"&&!l){var B=BX.type.isArray(c.ADDITIONAL)?c.ADDITIONAL:[];B.forEach(function(t){Object.keys(o).forEach(function(e){if(e.indexOf(t.NAME)!==-1){g.additional[e]=o[e];delete o[e]}})})}d=Object.keys(o);if(!s){g.apply_filter="Y"}else{g.clear_filter="Y"}g.save="Y";g.fields=o;g.rows=u.join(",");g.preset_id=e||c.ID;if(BX.type.isNotEmptyString(i)){g.name=BX.util.htmlspecialchars(i)}else{f=this.getPreset().getPresetNodeById(g.preset_id);m=this.getPreset().getPresetInput(f);if(BX.type.isDomNode(m)&&BX.type.isNotEmptyString(m.value)){g.name=m.value}else{g.name=c.TITLE}}if((!("sort"in g)||!BX.type.isNumber(g.sort))&&n){E=this.getParam("PRESETS");g.sort=E.length+2}if(!s){d.forEach(function(t){if(BX.type.isArray(g.fields[t])){p=g.fields[t].length?{}:"";g.fields[t].forEach(function(t,e){p[e]=t},this);if(p||BX.type.isNumber(p)||BX.type.isBoolean(p)){g.fields[t]=p}}},this)}if(g.preset_id==="tmp_filter"||this.isAddPresetEnabled()||s){this.updateParams(g)}if(BX.type.isFunction(a)){a()}var y=new BX.Promise(null,this);y.setAutoResolve("fulfill",0);y.then(function(){var t=new BX.Promise(null,this);this.saveOptions(g,h,BX.proxy(t.fulfill,t));return t}).then(function(){!!r&&r()});return y},saveFieldsSort:function t(){var e={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var i=this.getPreset().getFields();var s={};s.preset_id="default_filter";if(BX.type.isArray(i)){s.rows=i.map(function(t){return BX.data(t,"name")});s.rows=s.rows.join(",")}this.updateParams(s);this.saveOptions(s,e)},updateParams:function t(e){var i,s;if(BX.type.isPlainObject(e)&&"preset_id"in e){i=this.getPreset().getPreset(e.preset_id);if(BX.type.isPlainObject(i)){if("name"in e&&BX.type.isNotEmptyString(e.name)){i.TITLE=e.name}if("rows"in e&&!("fields"in e)){e.fields={};e.rows.split(",").forEach(function(t){e.fields[t]=""})}if("fields"in e){i.FIELDS=this.preparePresetFields(e.fields,e.rows)}if("additional"in e&&i.ID!=="tmp_filter"){i.ADDITIONAL=this.preparePresetFields(e.additional,e.rows)}}else{s=this.getParam("PRESETS");i={ID:e.preset_id,TITLE:e.name,SORT:s.length+2,FIELDS:this.preparePresetFields(e.fields,e.rows)};s.push(i)}}},preparePresetFields:function t(e,i){var s,n;var a=[];if(BX.type.isPlainObject(e)){i=BX.type.isNotEmptyString(i)?i.split(","):[];s=i.length?i:Object.keys(e);s.forEach(function(t){t=t.replace("_datesel","").replace("_numsel","");n=BX.clone(this.getFieldByName(t));if(BX.type.isPlainObject(n)){if(n.TYPE===this.types.STRING){n.VALUE=e[t]}if(n.TYPE===this.types.TEXTAREA){n.VALUE=e[t]}if(n.TYPE===this.types.MULTI_SELECT){n.VALUE=this.prepareMultiSelectValue(e[t],n.ITEMS)}if(n.TYPE===this.types.SELECT||n.TYPE===this.types.CHECKBOX){n.VALUE=this.prepareSelectValue(e[t],n.ITEMS)}if(n.TYPE===this.types.DATE){n.SUB_TYPE=this.prepareSelectValue(e[t+"_datesel"],n.SUB_TYPES);n.VALUES={_from:e[t+"_from"],_to:e[t+"_to"],_days:e[t+"_days"],_month:e[t+"_month"],_quarter:e[t+"_quarter"],_year:e[t+"_year"],_allow_year:e[t+"_allow_year"]}}if(n.TYPE===this.types.CUSTOM_DATE){n.VALUE={days:Object.keys(e[t+"_days"]||{}).map(function(i){return e[t+"_days"][i]}),months:Object.keys(e[t+"_months"]||{}).map(function(i){return e[t+"_months"][i]}),years:Object.keys(e[t+"_years"]||{}).map(function(i){return e[t+"_years"][i]})}}if(n.TYPE===this.types.NUMBER){n.SUB_TYPE=this.prepareSelectValue(e[t+"_numsel"],n.SUB_TYPES);n.VALUES={_from:e[t+"_from"],_to:e[t+"_to"]}}if(n.TYPE===this.types.DEST_SELECTOR){if(typeof e[t+"_label"]!=="undefined"){n.VALUES._label=e[t+"_label"]}if(typeof e[t]!=="undefined"){n.VALUES._value=e[t]}}if(n.TYPE===this.types.CUSTOM_ENTITY){if(typeof e[t+"_label"]!=="undefined"){n.VALUES._label=e[t+"_label"]}if(typeof e[t]!=="undefined"){n.VALUES._value=e[t]}}if(n.TYPE===this.types.CUSTOM){n._VALUE=e[t]}a.push(n)}},this)}return a},prepareSelectValue:function t(e,i){var s={};var n;if(BX.type.isNotEmptyString(e)&&BX.type.isArray(i)){n=this.prepareMultiSelectValue({0:e},i);s=n.length>0?n[0]:{}}else{s=i[0]}return s},prepareMultiSelectValue:function t(e,i){var s=[];if(BX.type.isPlainObject(e)&&BX.type.isArray(i)){var n=Object.keys(e);var a=n.map(function(t){return e[t]});s=i.filter(function(t){return a.some(function(e){return e===t.VALUE})},this)}return s},getFieldByName:function t(e){var i=this.getParam("FIELDS");i=i.filter(function(t){return t.NAME===e},this);return i.length>0?i[0]:null},confirmSaveForAll:function t(){return new Promise(function(t){var e={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("MAIN_UI_FILTER__CONFIRM_MESSAGE_FOR_ALL"),CONFIRM_APPLY_BUTTON:this.getParam("MAIN_UI_FILTER__CONFIRM_APPLY_FOR_ALL"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(e,t)}.bind(this))},saveOptions:function e(i,s,n,a){s.action=t(s.action);s.forAll=this.isForAll(a);s.commonPresetsId=this.getParam("COMMON_PRESETS_ID");s.apply_filter=i.apply_filter||"N";s.clear_filter=i.clear_filter||"N";s.with_preset=i.with_preset||"N";s.save=i.save||"N";var r={params:s,data:i};delete i.apply_filter;delete i.save;delete i.clear_filter;delete i.with_preset;if(s.forAll&&s.action==="setFilterArray"){return this.confirmSaveForAll().then(function(){return this.backend(s.action,r)}.bind(this)).then(function(){this.disableEdit();this.disableAddPreset()}.bind(this))}return this.backend(s.action,r).then(function(){BX.removeClass(this.getFindButton(),this.settings.classWaitButtonClass);BX.type.isFunction(n)&&n()}.bind(this))},backend:function t(e,i){return BX.ajax.runComponentAction("bitrix:main.ui.filter",e,{mode:"ajax",data:i,analyticsLabel:{FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID")}})},prepareEvent:function t(e){var i,s;if(!("path"in e)||!e.path.length){e.path=[e.target];i=0;while((s=e.path[i++].parentNode)!==null){e.path.push(s)}}return e},restoreRemovedPreset:function t(){if(this.getParam("VALUE_REQUIRED_MODE")){var e=this.getParam("CURRENT_PRESET");if(BX.type.isPlainObject(e)){var i=e.ID;var s=this.getPreset().getPresetNodeById(i);this.getPreset().applyPreset(i);this.getPreset().activatePreset(s)}}},hasScrollClick:function t(e){var i="clientX"in e?e.clientX:"x"in e?e.x:0;return i>=document.documentElement.offsetWidth},isUseCommonPresets:function t(){return!!this.getParam("COMMON_PRESETS_ID")},isInsideFilterEvent:function t(e){e=this.prepareEvent(e);return(e.path||[]).some(function(t){return BX.type.isDomNode(t)&&(BX.hasClass(t,this.settings.classFilterContainer)||BX.hasClass(t,this.settings.classSearchContainer)||BX.hasClass(t,this.settings.classDefaultPopup)||BX.hasClass(t,this.settings.classPopupOverlay))},this)},_onDocumentClick:function t(e){var i=this.getPopup();if(!this.isInsideFilterEvent(e)&&!this.hasScrollClick(e)){if(i&&i.isShown()){this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}if(this.getParam("VALUE_REQUIRED")){if(!this.getSearch().getSquares().length){this.getPreset().applyPinnedPreset()}}}BX.onCustomEvent(window,"BX.Main.Filter:blur",[this])}},_onAddFieldClick:function t(e){var i=this.getFieldsPopup();e.stopPropagation();e.preventDefault();if(i&&!i.isShown()){this.showFieldsPopup();this.syncFields()}else{this.closeFieldListPopup()}},syncFields:function t(e){if(BX.type.isPlainObject(e)){if(e.cache===false){this.fieldsPopupItems=null}}var i=this.getPreset().getFields();var s=this.getFieldsPopupItems();var n,a;if(BX.type.isArray(s)&&s.length){s.forEach(function(t){n=BX.data(t,"name").replace("_datesel","").replace("_numsel","");a=i.some(function(t){return BX.data(t,"name")===n});if(a){BX.addClass(t,this.settings.classMenuItemChecked)}else{BX.removeClass(t,this.settings.classMenuItemChecked)}},this)}},getFieldsPopupItems:function t(){if(!BX.type.isArray(this.fieldsPopupItems)){var e=this.getFieldsPopup();if("contentContainer"in e&&BX.type.isDomNode(e.contentContainer)){this.fieldsPopupItems=BX.Filter.Utils.getByClass(e.contentContainer,this.settings.classMenuItem,true)}}return this.fieldsPopupItems},getFieldListContainerClassName:function t(e){var i=this.settings.classPopupFieldList1Column;if(e>6&&e<12){i=this.settings.classPopupFieldList2Column}if(e>12){i=this.settings.classPopupFieldList3Column}return i},prepareFieldsDecl:function t(e){return(e||[]).map(function(t){return{block:"main-ui-filter-field-list-item",label:"LABEL"in t?t.LABEL:"",id:"ID"in t?t.ID:"",name:"NAME"in t?t.NAME:"",item:t,onClick:BX.delegate(this._clickOnFieldListItem,this)}},this)},getLazyLoadFields:function t(){var e=new BX.Promise;BX.ajax({method:"GET",url:this.getParam("LAZY_LOAD")["GET_LIST"],dataType:"json",onsuccess:function t(i){e.fulfill(i)}});return e},getFieldsListPopupContent:function t(){var e=new BX.Promise;var i=this.getParam("FIELDS");var s=BX.type.isArray(i)?i.length:0;if(this.getParam("LAZY_LOAD")){var n=function(t){var i={block:this.settings.classPopupFieldList,mix:this.getFieldListContainerClassName(t.length),content:this.prepareFieldsDecl(t)};e.fulfill(BX.decl(i))}.bind(this);if(BX.type.isNotEmptyObject(this.getParam("LAZY_LOAD")["CONTROLLER"])){var a=this.getParam("LAZY_LOAD")["CONTROLLER"]["componentName"];var r=this.getParam("LAZY_LOAD")["CONTROLLER"]["signedParameters"];BX.ajax.runAction(this.getParam("LAZY_LOAD")["CONTROLLER"]["getList"],{data:{filterId:this.getParam("FILTER_ID"),componentName:BX.type.isNotEmptyString(a)?a:"",signedParameters:BX.type.isNotEmptyString(r)?r:""}}).then(function(t){n(t.data)}.bind(this),function(t){})}else{this.getLazyLoadFields().then(n)}return e}var l={block:this.settings.classPopupFieldList,mix:this.getFieldListContainerClassName(s),content:this.prepareFieldsDecl(i)};e.fulfill(BX.decl(l));return e},getFieldLoader:function t(){if(!this.fieldLoader){this.fieldLoader=new BX.Loader({mode:"custom",size:18,offset:{left:"5px",top:"5px"}})}return this.fieldLoader},_clickOnFieldListItem:function t(e){var i=e.target;var s;if(!BX.hasClass(i,this.settings.classFieldListItem)){i=BX.findParent(i,{className:this.settings.classFieldListItem},true,false)}if(BX.type.isDomNode(i)){try{s=JSON.parse(BX.data(i,"item"))}catch(t){}var n=new BX.Promise;if(this.getParam("LAZY_LOAD")){this.getFieldLoader().show(i);var a=i.querySelector(".main-ui-select-inner-label");if(a){a.classList.add("main-ui-no-before")}var r=function(t){n.fulfill(t);this.getFieldLoader().hide();if(a){a.classList.remove("main-ui-no-before")}}.bind(this);if(BX.type.isNotEmptyObject(this.getParam("LAZY_LOAD")["CONTROLLER"])){var l=this.getParam("LAZY_LOAD")["CONTROLLER"]["componentName"];var o=this.getParam("LAZY_LOAD")["CONTROLLER"]["signedParameters"];BX.ajax.runAction(this.getParam("LAZY_LOAD")["CONTROLLER"]["getField"],{data:{filterId:this.getParam("FILTER_ID"),id:s.NAME,componentName:BX.type.isNotEmptyString(l)?l:"",signedParameters:BX.type.isNotEmptyString(o)?o:""}}).then(function(t){r(t.data)}.bind(this),function(t){})}else{this.getLazyLoadField(s.NAME).then(r)}}else{n.fulfill(s)}n.then(function(t){this.params.FIELDS.push(t);if(BX.hasClass(i,this.settings.classMenuItemChecked)){BX.removeClass(i,this.settings.classMenuItemChecked);this.getPreset().removeField(t)}else{if(BX.type.isPlainObject(t)){this.getPreset().addField(t);BX.addClass(i,this.settings.classMenuItemChecked);if(BX.type.isString(t.HTML)){var e=BX.create("div");this.getHiddenElement().appendChild(e);BX.html(e,t.HTML)}}}this.syncFields()}.bind(this))}},getHiddenElement:function t(){if(!this.hiddenElement){this.hiddenElement=BX.create("div");document.body.appendChild(this.hiddenElement)}return this.hiddenElement},getLazyLoadField:function t(e){var i=new BX.Promise;BX.ajax({method:"get",url:BX.util.add_url_param(this.getParam("LAZY_LOAD")["GET_FIELD"],{id:e}),dataType:"json",onsuccess:function t(e){i.fulfill(e)}});return i},showFieldsPopup:function t(){var e=this.getFieldsPopup();this.adjustFieldListPopupPosition();e.show()},closeFieldListPopup:function t(){var e=this.getFieldsPopup();e.close()},adjustFieldListPopupPosition:function t(){var e=this.getFieldsPopup();var i=BX.pos(this.getAddField());i.forceBindPosition=true;e.adjustPosition(i)},getFieldsPopup:function t(){var e=this.getAddField();if(!this.fieldsPopup){this.fieldsPopup=new BX.PopupWindow(this.getParam("FILTER_ID")+"_fields_popup",e,{autoHide:true,offsetTop:4,offsetLeft:0,lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:13});this.fieldsPopupLoader=new BX.Loader({target:this.fieldsPopup.contentContainer});this.fieldsPopupLoader.show();this.fieldsPopup.contentContainer.style.width="630px";this.fieldsPopup.contentContainer.style.height="330px";this.getFieldsListPopupContent().then(function(t){this.fieldsPopup.contentContainer.removeAttribute("style");this.fieldsPopupLoader.hide();this.fieldsPopup.setContent(t);this.syncFields({cache:false})}.bind(this))}return this.fieldsPopup},_onAddPresetClick:function t(){this.enableAddPreset()},enableWaitSate:function t(e){!!e&&BX.addClass(e,this.settings.classWaitButtonClass)},disableWaitState:function t(e){!!e&&BX.removeClass(e,this.settings.classWaitButtonClass)},_onSaveButtonClick:function t(){var e=!!this.getSaveForAllCheckbox()&&this.getSaveForAllCheckbox().checked;var i=this.getPreset().getAddPresetFieldInput();var s=i.parentNode.querySelector(".main-ui-filter-edit-mask");var n;function a(t){if(t.animationName==="fieldError"){t.currentTarget.removeEventListener("animationend",a);t.currentTarget.removeEventListener("oAnimationEnd",a);t.currentTarget.removeEventListener("webkitAnimationEnd",a);t.currentTarget.classList.remove("main-ui-filter-error")}}function r(t){t.addEventListener("animationend",a);t.addEventListener("oAnimationEnd",a);t.addEventListener("webkitAnimationEnd",a);t.classList.add("main-ui-filter-error");var e=new BX.Promise;e.fulfill(true);return e}this.enableWaitSate(this.getFindButton());if(this.isAddPresetEnabled()&&!e){n=i.value;if(n.length){this.savePreset();this.disableAddPreset()}else{r(s).then(function(){i.focus()})}}if(this.isEditEnabled()){var l=this.getPreset();var o=l.getPresetNodeById(l.getCurrentPresetId());var u=l.getPresetInput(o);if(u.value.length){l.updateEditablePreset(l.getCurrentPresetId());this.saveUserSettings(e);!e&&this.disableEdit()}else{var c=o.querySelector(".main-ui-filter-edit-mask");r(c).then(function(){u.focus()})}}},_onCancelButtonClick:function t(){this.disableAddPreset();this.getPreset().clearAddPresetFieldInput();this.disableEdit();!!this.getSaveForAllCheckbox()&&(this.getSaveForAllCheckbox().checked=null)},_onGridReady:function t(e){if(!this.grid&&e.getContainerId()===this.getParam("GRID_ID")){this.grid=e}},_onFilterMousedown:function t(e){var i=e.target;if(this.getFields().isDragButton(i)){var s=BX.Filter.Utils.getByTag(i.parentNode,"input",true);(s||[]).forEach(function(t){BX.fireEvent(t,"blur")});BX.fireEvent(this.getFilter(),"click")}},_onFilterClick:function t(e){var i=this.getFields();var s=this.getPreset();var n;if(i.isFieldDelete(e.target)){n=i.getField(e.target);s.removeField(n)}if(i.isFieldValueDelete(e.target)){n=i.getField(e.target);i.clearFieldValue(n)}},getButtonsContainer:function t(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classButtonsContainer)},getSaveButton:function t(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSaveButton)},getCancelButton:function t(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classCancelButton)},getFindButton:function t(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFindButton)},getResetButton:function t(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classResetButton)},getAddPresetButton:function t(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddPresetButton)},isAddPresetEnabled:function t(){return this.isAddPresetModeState},enableAddPreset:function t(){var e=this.getPreset();var i=e.getAddPresetField();var s=e.getAddPresetFieldInput();var n=this.getButtonsContainer();BX.show(i);BX.show(n);BX.hide(this.getPresetButtonsContainer());this.hideForAllCheckbox();if(BX.type.isDomNode(s)){s.focus()}BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=true},disableAddPreset:function t(){var e=this.getPreset();var i=e.getAddPresetField();var s=this.getButtonsContainer();BX.hide(i);BX.hide(s);BX.show(this.getPresetButtonsContainer());this.showForAllCheckbox();e.getAddPresetFieldInput().value="";BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=false},getControls:function t(){var e=this.getFieldListContainer();var i=null;if(BX.type.isDomNode(e)){i=BX.Filter.Utils.getByClass(e,this.settings.classControl,true)}return i},getFilterFields:function t(){var e=this.getFieldListContainer();var i=[];var s=[];if(BX.type.isDomNode(e)){i=BX.Filter.Utils.getByClass(e,this.settings.classField,true);s=BX.Filter.Utils.getByClass(e,this.settings.classFieldGroup,true);if(!BX.type.isArray(i)){i=[]}if(BX.type.isArray(s)){s.forEach(function(t){i.push(t)})}}return i},getFilterFieldsValues:function t(){var e=this.getPreset().getFields();var i=this.getSearch();var s={};var n,a;s["FIND"]=i.getInput().value;if(BX.type.isArray(e)&&e.length){e.forEach(function(t){n=BX.data(t,"type");a=BX.data(t,"name");switch(n){case this.types.STRING:{this.prepareControlStringValue(s,t);break}case this.types.TEXTAREA:{this.prepareControlTextareaValue(s,t);break}case this.types.NUMBER:{this.prepareControlNumberValue(s,a,t);break}case this.types.DATE:{this.prepareControlDateValue(s,a,t);break}case this.types.CUSTOM_DATE:{this.prepareControlCustomDateValue(s,a,t);break}case this.types.SELECT:{this.prepareControlSelectValue(s,a,t);break}case this.types.MULTI_SELECT:{this.prepareControlMultiselectValue(s,a,t);break}case this.types.DEST_SELECTOR:{this.prepareControlCustomEntityValue(s,a,t);break}case this.types.CUSTOM:{this.prepareControlCustomValue(s,a,t);break}case this.types.CUSTOM_ENTITY:{this.prepareControlCustomEntityValue(s,a,t);break}default:{break}}},this)}return s},prepareControlCustomEntityValue:function t(e,i,s){var n=this.fetchSquares(s);var a=this.fetchSquaresData(n);var r=BX.Main.ui.CustomEntity.isMultiple(s);e[i]="";e[i+"_label"]="";if(r){e[i]=[];e[i+"_label"]=[];!!a&&a.forEach(function(t){e[i].push(t._value.toString());e[i+"_label"].push(t._label.toString())})}else{if(a.length){e[i]=a[0]._value.toString();e[i+"_label"]=a[0]._label.toString()}}},fetchSquares:function t(e){return!!e?BX.Filter.Utils.getByClass(e,this.settings.classSquare,true):[]},fetchSquaresData:function t(e){return e.map(function(t){return JSON.parse(BX.data(t,"item"))},this)},prepareControlCustomValue:function t(e,i,s){var n=BX.Filter.Utils.getByTag(s,"input",true);e[i]="";if(BX.type.isArray(n)){n.forEach(function(t){if(BX.type.isNotEmptyString(t.name)){e[t.name]=t.value}})}},prepareControlMultiselectValue:function t(e,i,s){var n=BX.Filter.Utils.getByClass(s,this.settings.classMultiSelect);var a=JSON.parse(BX.data(n,"value"));e[i]="";if(BX.type.isArray(a)&&a.length){e[i]={};a.forEach(function(t,s){e[i][s]=t.VALUE})}},prepareControlSelectValue:function t(e,i,s){var n=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var a=JSON.parse(BX.data(n,"value"));e[i]=a.VALUE},prepareControlCustomDateValue:function t(e,i,s){var n=s.querySelector('[data-name="'+i+"_days"+'"]');if(n){var a=JSON.parse(n.dataset.value);e[i+"_days"]=a.map(function(t){return t.VALUE})}var r=s.querySelector('[data-name="'+i+"_months"+'"]');if(r){var l=JSON.parse(r.dataset.value);e[i+"_months"]=l.map(function(t){return t.VALUE})}var o=s.querySelector('[data-name="'+i+"_years"+'"]');if(o){var u=JSON.parse(o.dataset.value);e[i+"_years"]=u.map(function(t){return t.VALUE})}},prepareControlDateValue:function t(e,i,s){var n=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var a=s.querySelector('.main-ui-select[data-name*="_allow_year"]');var r=i+this.settings.datePostfix;var l=i+this.settings.fromPostfix;var o=i+this.settings.toPostfix;var u=i+this.settings.daysPostfix;var c=i+this.settings.monthPostfix;var h=i+this.settings.quarterPostfix;var d=i+this.settings.yearPostfix;var p=i+"_allow_year";var f,m,E,g,B;e[r]="";e[l]="";e[o]="";e[u]="";e[c]="";e[h]="";e[d]="";var y=s.querySelector(".main-ui-date-input");if(y&&y.dataset.isValid==="false"){return}f=JSON.parse(BX.data(n,"value"));e[r]=f.VALUE;if(a){B=JSON.parse(BX.data(a,"value"));e[p]=B.VALUE}switch(f.VALUE){case this.dateTypes.EXACT:{m=BX.Filter.Utils.getByClass(s,this.settings.classDateInput);e[l]=m.value;e[o]=m.value;break}case this.dateTypes.QUARTER:{E=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(E)){E.forEach(function(t){g=BX.data(t,"name");if(g&&g.indexOf("_quarter")!==-1){e[h]=JSON.parse(BX.data(t,"value")).VALUE}if(g&&g.endsWith("_year")&&!g.endsWith("_allow_year")){e[d]=JSON.parse(BX.data(t,"value")).VALUE}},this)}break}case this.dateTypes.YEAR:{E=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(E)){E.forEach(function(t){g=BX.data(t,"name");if(g&&g.endsWith("_year")&&!g.endsWith("_allow_year")){e[d]=JSON.parse(BX.data(t,"value")).VALUE}},this)}break}case this.dateTypes.MONTH:{E=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(E)){E.forEach(function(t){g=BX.data(t,"name");if(g&&g.indexOf("_month")!==-1){e[c]=JSON.parse(BX.data(t,"value")).VALUE}if(g&&g.endsWith("_year")&&!g.endsWith("_allow_year")){e[d]=JSON.parse(BX.data(t,"value")).VALUE}},this)}break}case this.additionalDateTypes.PREV_DAY:case this.additionalDateTypes.NEXT_DAY:case this.additionalDateTypes.MORE_THAN_DAYS_AGO:case this.additionalDateTypes.AFTER_DAYS:case this.dateTypes.NEXT_DAYS:case this.dateTypes.PREV_DAYS:{var A=BX.Filter.Utils.getByClass(s,this.settings.classNumberInput);if(!!A&&A.name===u){e[u]=A.value}break}case this.dateTypes.RANGE:{m=BX.Filter.Utils.getByClass(s,this.settings.classDateInput,true);m.forEach(function(t){if(t.name===l){e[l]=t.value}else if(t.name===o){e[o]=t.value}},this);break}case"CUSTOM_DATE":{var v={};this.prepareControlCustomDateValue(v,i,s);e[i+"_days"]=v[i+"_days"];e[c]=v[i+"_months"];e[d]=v[i+"_years"];break}default:{break}}var P=Array.from(s.querySelectorAll('.main-ui-filter-additional-fields-container > [data-type="DATE"]'));if(P){P.forEach(function(t){var i=t.dataset.name;this.prepareControlDateValue(e,i,t)},this)}},prepareControlNumberValue:function t(e,i,s){var n=BX.Filter.Utils.getByClass(s,this.settings.classNumberInput,true);var a=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var r=i+this.settings.numberPostfix;var l=i+this.settings.fromPostfix;var o=i+this.settings.toPostfix;var u;e[l]="";e[o]="";u=JSON.parse(BX.data(a,"value"));e[r]=u.VALUE;n.forEach(function(t){if(t.name.indexOf(this.settings.fromPostfix)!==-1){e[l]=t.value||"";if(e[r]==="exact"){e[o]=t.value||""}}else if(t.name.indexOf(this.settings.toPostfix)!==-1){e[o]=t.value||""}},this)},prepareControlStringValue:function t(e,i){var s=BX.Filter.Utils.getByClass(i,this.settings.classStringInput);var n;if(BX.type.isDomNode(s)){n=s.name;e[n]=s.value}},prepareControlTextareaValue:function t(e,i){var s=BX.Filter.Utils.getByClass(i,this.settings.classStringInput);var n;if(BX.type.isDomNode(s)){n=s.name;e[n]=s.value}},showGridAnimation:function t(){this.grid&&this.grid.tableFade()},hideGridAnimation:function t(){this.grid&&this.grid.tableUnfade()},getPresetId:function t(e,i){var s=this.getPreset().getCurrentPresetId();if(!this.isEditEnabled()&&!this.isAddPresetEnabled()&&!i||s==="default_filter"&&!e){s="tmp_filter"}return s},applyFilter:function t(e,i){var s=this.getPresetId(e,i);var n=this.getParam("FILTER_ID");var a=new BX.Promise(null,this);var r=this.getPreset();var l=this.getSearch();var o={autoResolve:!this.grid};var u=this;this.clearGet();this.showGridAnimation();var c=e?"clear":"apply";BX.onCustomEvent(window,"BX.Main.Filter:beforeApply",[n,{action:c},this,a]);this.updatePreset(s,null,e,null).then(function(){l.updatePreset(r.getPreset(s));if(u.getParam("VALUE_REQUIRED")){if(!l.getSquares().length){u.lastPromise=r.applyPinnedPreset()}}}).then(function(){var t={apply_filter:"Y",clear_nav:"Y"};var e=BX.delegate(a.fulfill,a);var i=BX.delegate(a.reject,a);u.grid&&u.grid.reloadTable("POST",t,e,i);BX.onCustomEvent(window,"BX.Main.Filter:apply",[n,{action:c},u,a,o]);o.autoResolve&&a.fulfill()});return a},getAddField:function t(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddField)},getFieldListContainer:function t(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFileldControlList)},getFields:function t(){if(!(this.fields instanceof BX.Filter.Fields)){this.fields=new BX.Filter.Fields(this)}return this.fields},getPreset:function t(){if(!(this.presets instanceof BX.Filter.Presets)){this.presets=new BX.Filter.Presets(this)}return this.presets},resetControlData:function t(e){if(BX.type.isPlainObject(e)){switch(e.TYPE){case this.types.MULTI_SELECT:{e.VALUE=[];break}case this.types.SELECT:{e.VALUE=e.ITEMS[0];break}case this.types.DATE:{e.SUB_TYPE=e.SUB_TYPES[0];e.VALUES={_from:"",_to:"",_days:"",_quarter:"",_year:""};break}case this.types.CUSTOM_DATE:{e.VALUES={days:[],months:[],years:[]};break}case this.types.NUMBER:{e.SUB_TYPE=e.SUB_TYPES[0];e.VALUES={_from:"",_to:""};break}case this.types.DEST_SELECTOR:{e.VALUES={_label:"",_value:""};break}case this.types.CUSTOM_ENTITY:{e.VALUES={_label:"",_value:""};break}case this.types.CUSTOM:{e._VALUE="";break}default:{e.VALUE=""}}}return e},clearControl:function t(e){var i=this.getPreset().getField({NAME:e});var s,n;if(BX.type.isDomNode(i)){s=this.getFieldByName(e);s=this.resetControlData(s);n=this.getPreset().createControl(s);BX.insertAfter(n,i);BX.remove(i)}},clearControls:function t(e){if(BX.type.isArray(e)){e.forEach(function(t){"name"in t&&this.clearControl(t.name)},this)}else if(BX.type.isPlainObject(e)&&"name"in e){this.clearControl(e.name)}},getTemplate:function t(){return BX.html(BX(this.settings.generalTemplateId))},isIe:function t(){if(!BX.type.isBoolean(this.ie)){this.ie=BX.hasClass(document.documentElement,"bx-ie")}return this.ie},closePopup:function t(){var e=this.getPopup();var i=e.popupContainer;var s=this.settings.get("FILTER_CLOSE_DELAY");var n;setTimeout(BX.delegate(function(){if(!this.isIe()){BX.removeClass(i,this.settings.classAnimationShow);BX.addClass(i,this.settings.classAnimationClose);n=parseFloat(BX.style(i,"animation-duration"));if(BX.type.isNumber(n)){n=n*1e3}setTimeout(function(){e.close()},n)}else{e.close()}},this),s);if(this.getParam("LIMITS_ENABLED")){BX.removeClass(this.getFilter(),this.settings.classLimitsAnimation)}this.closeFieldListPopup();this.adjustFocus()},showPopup:function t(){var e=this.getPopup();var i;if(!e.isShown()){this.isOpened=true;var s=this.settings.get("FILTER_SHOW_DELAY");setTimeout(BX.delegate(function(){e.show();if(!this.isIe()){i=e.popupContainer;BX.removeClass(i,this.settings.classAnimationClose);BX.addClass(i,this.settings.classAnimationShow);BX.onCustomEvent(window,"BX.Main.Filter:show",[this])}var t=[].slice.call(this.getFieldListContainer().querySelectorAll("textarea"));t.forEach(function(t){BX.style(t,"height",t.scrollHeight+"px")})},this),s)}},getSaveForAllCheckbox:function t(){if(!this.saveForAllCheckbox&&!!this.getSaveForAllCheckboxContainer()){this.saveForAllCheckbox=BX.Filter.Utils.getBySelector(this.getSaveForAllCheckboxContainer(),'input[type="checkbox"]')}return this.saveForAllCheckbox},getSaveForAllCheckboxContainer:function t(){if(!this.saveForAllCheckboxContainer){this.saveForAllCheckboxContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.saveForAllCheckboxContainer},showForAllCheckbox:function t(){!!this.getSaveForAllCheckboxContainer()&&BX.removeClass(this.getSaveForAllCheckboxContainer(),this.settings.classHide)},hideForAllCheckbox:function t(){!!this.getSaveForAllCheckboxContainer()&&BX.addClass(this.getSaveForAllCheckboxContainer(),this.settings.classHide)},getPopupBindElement:function t(){if(!this.popupBindElement){var e=this.settings.get("POPUP_BIND_ELEMENT_SELECTOR");var i=null;if(BX.type.isNotEmptyString(e)){i=BX.Filter.Utils.getBySelector(document,e)}this.popupBindElement=!!i?i:this.getSearch().getContainer()}return this.popupBindElement},getPopup:function t(){if(!(this.popup instanceof BX.PopupWindow)){this.popup=new BX.PopupWindow(this.getParam("FILTER_ID")+this.settings.searchContainerPostfix,this.getPopupBindElement(),{autoHide:false,offsetTop:parseInt(this.settings.get("POPUP_OFFSET_TOP")),offsetLeft:parseInt(this.settings.get("POPUP_OFFSET_LEFT")),lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:12});this.popup.setContent(this.getTemplate());BX.bind(this.getFieldListContainer(),"keydown",BX.delegate(this._onFieldsContainerKeydown,this));BX.bind(this.getFilter(),"click",BX.delegate(this._onFilterClick,this));BX.bind(this.getAddPresetButton(),"click",BX.delegate(this._onAddPresetClick,this));BX.bind(this.getPreset().getAddPresetFieldInput(),"keydown",BX.delegate(this._onAddPresetKeydown,this));BX.bind(this.getPreset().getContainer(),"keydown",BX.delegate(this._onPresetInputKeydown,this));BX.bind(this.getSaveButton(),"click",BX.delegate(this._onSaveButtonClick,this));BX.bind(this.getCancelButton(),"click",BX.delegate(this._onCancelButtonClick,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onFindButtonClick,this));BX.bind(this.getResetButton(),"click",BX.delegate(this._onResetButtonClick,this));BX.bind(this.getAddField(),"click",BX.delegate(this._onAddFieldClick,this));BX.bind(this.getEditButton(),"click",BX.delegate(this._onEditButtonClick,this));BX.bind(this.getRestoreButton(),"click",BX.delegate(this._onRestoreButtonClick,this));BX.bind(this.getRestoreFieldsButton(),"click",BX.delegate(this._onRestoreFieldsButtonClick,this));this.getFilter().addEventListener("mousedown",BX.delegate(this._onFilterMousedown,this),true);this.getPreset().showCurrentPresetFields();this.getPreset().bindOnPresetClick()}return this.popup},_onRestoreFieldsButtonClick:function t(){this.restoreDefaultFields()},restoreDefaultFields:function t(){var e=this.getPreset().getPreset("default_filter",true);var i=this.getParam("PRESETS");var s=this.getPreset().getCurrentPresetId();var n={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var a=e.FIELDS.map(function(t){return t.NAME});var r=a.join(",");i.forEach(function(t,s){if(t.ID==="default_filter"){i[s]=BX.clone(e)}},this);if(BX.type.isArray(this.editablePresets)){this.editablePresets.forEach(function(t,i){if(t.ID==="default_filter"){this.editablePresets[i]=BX.clone(e)}},this)}this.getPreset().applyPreset(s);this.updatePreset(s);this.saveOptions({preset_id:"default_filter",rows:r,save:"Y",apply_filter:"N"},n)},getRestoreFieldsButton:function t(){if(!this.restoreFieldsButton){this.restoreFieldsButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreFieldsButton)}return this.restoreFieldsButton},restoreFilter:function t(){var e=this.getParam("DEFAULT_PRESETS");var i=this.getParam("PRESETS");var s=false;var n,a,r;if(BX.type.isArray(e)){e.sort(function(t,e){return t.SORT<e.SORT});e.forEach(function(t){s=i.some(function(e,i){if(e.ID===t.ID){n=i;return true}});if(s){i[n]=BX.clone(t)}else{i.push(BX.clone(t))}if(t.ID!=="default_filter"){this.addSidebarItem(t.ID,t.TITLE,t.PINNED);if(t.PINNED){a=t.ID}}},this)}this.saveRestoreFilter();this.disableAddPreset();this.disableEdit();if(!a){a="default_filter"}r=this.getPreset().getPresetNodeById(a);if(r){BX.fireEvent(r,"click")}},saveRestoreFilter:function t(){var e={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"RESTORE_FILTER"};var i=this.getParam("PRESETS");var s={};var n;if(BX.type.isArray(i)){i.forEach(function(t){n=t.FIELDS.map(function(t){return t.NAME});n=n.join(",");s[t.ID]={name:t.TITLE||null,sort:t.SORT,preset_id:t.ID,fields:this.prepareFields(t.FIELDS),rows:n,for_all:t.FOR_ALL}},this);this.saveOptions(s,e)}},prepareFields:function t(e){var i={};var s;if(BX.type.isArray(e)){e.forEach(function(t){if(t.TYPE===this.types.SELECT){i[t.NAME]="VALUE"in t.VALUE?t.VALUE.VALUE:""}if(t.TYPE===this.types.MULTI_SELECT){t.VALUE.forEach(function(e,s){i[t.NAME]=i[t.NAME]||{};i[t.NAME][s]=e.VALUE});i[t.NAME]=i[t.NAME]||""}if(t.TYPE===this.types.DATE||t.TYPE===this.types.NUMBER){s=Object.keys(t.VALUES);s.forEach(function(e){i[t.NAME+e]=t.VALUES[e]});if(t.TYPE===this.types.DATE){i[t.NAME+"_datesel"]="VALUE"in t.SUB_TYPE?t.SUB_TYPE.VALUE:t.SUB_TYPES[0].VALUE}if(t.TYPE===this.types.NUMBER){i[t.NAME+"_numsel"]="VALUE"in t.SUB_TYPE?t.SUB_TYPE.VALUE:t.SUB_TYPES[0].VALUE}}if(t.TYPE===this.types.DEST_SELECTOR){i[t.NAME+"_label"]=t.VALUES._label;i[t.NAME+"_value"]=t.VALUES._value}if(t.TYPE===this.types.CUSTOM_ENTITY){i[t.NAME+"_label"]=t.VALUES._label;i[t.NAME+"_value"]=t.VALUES._value}},this)}return i},getRestoreButton:function t(){if(!BX.type.isDomNode(this.restoreButton)){this.restoreButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreButton)}return this.restoreButton},_onPresetInputKeydown:function t(e){if(BX.Filter.Utils.isKey(e,"enter")&&e.target.tagName==="INPUT"){BX.fireEvent(this.getSaveButton(),"click")}},_onFieldsContainerKeydown:function t(e){if(BX.Filter.Utils.isKey(e,"enter")&&e.target.tagName==="INPUT"){BX.fireEvent(this.getFindButton(),"click")}},_onFindButtonClick:function t(){var e=this.getPreset();var i=e.getCurrentPresetId();var s;if(i!=="tmp_filter"&&i!=="default_filter"&&!e.isPresetValuesModified(i)){var n=e.getPreset(i);var a=e.getAdditionalValues(i);var r=e.getFields().map(function(t){return BX.data(t,"name")});n.ADDITIONAL=this.preparePresetFields(a,r);n.ADDITIONAL=n.ADDITIONAL.filter(function(t){return!this.getPreset().isEmptyField(t)},this);e.applyPreset(i);s=this.applyFilter(false,i);this.closePopup()}else{e.deactivateAllPresets();s=this.applyFilter();this.closePopup()}return s},_onResetButtonClick:function t(){if(this.getParam("VALUE_REQUIRED")){var e=this.getPreset().getCurrentPresetData();if(e.ADDITIONAL.length){this.closePopup()}BX.fireEvent(this.getSearch().getClearButton(),"click")}else{if(this.getParam("RESET_TO_DEFAULT_MODE")){this.getSearch().clearInput();this.getPreset().applyPinnedPreset()}else{this.resetFilter()}this.closePopup()}},resetFilter:function t(e){var i=this.getSearch();var s=this.getPreset();if(!e){i.clearInput()}i.removePreset();s.deactivateAllPresets();s.resetPreset(true);i.hideClearButton();i.adjustPlaceholder();return this.applyFilter(true,true)},_onEditButtonClick:function t(){if(!this.isEditEnabled()){this.enableEdit()}else{this.disableEdit()}},enableFieldsDragAndDrop:function t(){var e=this.getPreset().getFields();this.fieldsList=[];if(BX.type.isArray(e)){this.fieldsList=e.map(this.registerDragItem,this)}},registerDragItem:function t(e){var i=this.getDragButton(e);if(i){i.onbxdragstart=BX.delegate(this._onFieldDragStart,this);i.onbxdragstop=BX.delegate(this._onFieldDragStop,this);i.onbxdrag=BX.delegate(this._onFieldDrag,this);jsDD.registerObject(i);jsDD.registerDest(i)}return e},unregisterDragItem:function t(e){var i=this.getDragButton(e);if(i){jsDD.unregisterObject(i);jsDD.unregisterDest(i)}},_onFieldDragStart:function t(){this.dragItem=this.getFields().getField(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.fieldsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onFieldDragStop:function t(){BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);this.fieldsList=this.getPreset().getFields();this.saveFieldsSort()},_onFieldDrag:function t(){var e=this;var i,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=e.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.fieldsList.forEach(function(t,n){if(t){i=t.getBoundingClientRect();s=i.top+BX.scrollTop(window)+i.height/2;if(n>e.dragIndex&&e.sortOffset>s&&t.style.transform!=="translate3d(0px, "+-e.offset+"px, 0px)"&&t.style.transform!==""){e.targetItem=t;BX.style(t,"transform","translate3d(0px, "+-e.offset+"px, 0px)");BX.style(t,"transition","300ms")}if(n<e.dragIndex&&e.sortOffset<s&&t.style.transform!=="translate3d(0px, "+e.offset+"px, 0px)"&&t.style.transform!==""){e.targetItem=t;BX.style(t,"transform","translate3d(0px, "+e.offset+"px, 0px)");BX.style(t,"transition","300ms")}if((n<e.dragIndex&&e.sortOffset>s||n>e.dragIndex&&e.sortOffset<s)&&t.style.transform!=="translate3d(0px, 0px, 0px)"){if(t.style.transform!==""){e.targetItem=t}BX.style(t,"transform","translate3d(0px, 0px, 0px)");BX.style(t,"transition","300ms")}}})},disableFieldsDragAndDrop:function t(){if(BX.type.isArray(this.fieldsList)&&this.fieldsList.length){this.fieldsList.map(this.unregisterDragItem,this)}},enablePresetsDragAndDrop:function t(){var e,i,s,n;e=this.getPreset();i=e.getPresets();this.presetsList=[];if(BX.type.isArray(i)&&i.length){i.forEach(function(t){n=e.getPresetId(t);if(!BX.hasClass(t,this.settings.classAddPresetField)&&n!=="default_filter"&&!BX.hasClass(t,this.settings.classDefaultFilter)){s=this.getDragButton(t);s.onbxdragstart=BX.delegate(this._onDragStart,this);s.onbxdragstop=BX.delegate(this._onDragStop,this);s.onbxdrag=BX.delegate(this._onDrag,this);jsDD.registerObject(s);jsDD.registerDest(s);this.presetsList.push(t)}},this)}},getDragButton:function t(e){return BX.Filter.Utils.getByClass(e,this.settings.classPresetDragButton)},disablePresetsDragAndDrop:function t(){if(BX.type.isArray(this.presetsList)&&this.presetsList.length){this.presetsList.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)){jsDD.unregisterObject(t);jsDD.unregisterDest(t)}},this)}},_onDragStart:function t(){this.dragItem=this.getPreset().normalizePreset(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.presetsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.list,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onMouseMove:function t(e){this.realX=e.clientX;this.realY=e.clientY},getDragOffset:function t(){return jsDD.x-this.startDragOffset-this.dragRect.left},_onDragStop:function t(){var e,i;BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.presetsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);e=this.getPreset();i=e.getPresets();this.presetsList=[];if(BX.type.isArray(i)&&i.length){i.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)&&!BX.hasClass(t,this.settings.classDefaultFilter)){this.presetsList.push(t)}},this)}},_onDrag:function t(){var e=this;var i,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=e.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.presetsList.forEach(function(t,n){if(t){i=t.getBoundingClientRect();s=i.top+BX.scrollTop(window)+i.height/2;if(n>e.dragIndex&&e.sortOffset>s&&t.style.transform!=="translate3d(0px, "+-e.offset+"px, 0px)"&&t.style.transform!==""){e.targetItem=t;BX.style(t,"transform","translate3d(0px, "+-e.offset+"px, 0px)");BX.style(t,"transition","300ms")}if(n<e.dragIndex&&e.sortOffset<s&&t.style.transform!=="translate3d(0px, "+e.offset+"px, 0px)"&&t.style.transform!==""){e.targetItem=t;BX.style(t,"transform","translate3d(0px, "+e.offset+"px, 0px)");BX.style(t,"transition","300ms")}if((n<e.dragIndex&&e.sortOffset>s||n>e.dragIndex&&e.sortOffset<s)&&t.style.transform!=="translate3d(0px, 0px, 0px)"){if(t.style.transform!==""){e.targetItem=t}BX.style(t,"transform","translate3d(0px, 0px, 0px)");BX.style(t,"transition","300ms")}}})},getSidebarControlsContainer:function t(){if(!BX.type.isDomNode(this.sidebarControlsContainer)){this.sidebarControlsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSidebarControlsContainer)}return this.sidebarControlsContainer},enableEdit:function t(){var e=this.getPreset();var i=e.getPresets();var s;if(BX.type.isArray(i)&&i.length){i.forEach(function(t){s=e.getPresetId(t);if(!BX.hasClass(t,this.settings.classAddPresetField)&&s!=="default_filter"){BX.addClass(t,this.settings.classPresetEdit)}},this)}this.enablePresetsDragAndDrop();BX.show(this.getButtonsContainer());BX.hide(this.getPresetButtonsContainer());BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=BX.clone(this.getParam("PRESETS"));this.isEditEnabledState=true},disableEdit:function t(){var e=this.getPreset();var i=e.getPresets();if(BX.type.isArray(i)&&i.length){i.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)){BX.removeClass(t,this.settings.classPresetEdit);this.getPreset().disableEditPresetName(t)}},this)}this.disablePresetsDragAndDrop();if(!this.isAddPresetEnabled()){BX.style(this.getButtonsContainer(),"display","")}BX.show(this.getPresetButtonsContainer());BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=null;this.isEditEnabledState=false;this.applyFilter(null,true)},getPresetButtonsContainer:function t(){if(!BX.type.isDomNode(this.presetButtonsContainer)){this.presetButtonsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classPresetButtonsContainer)}return this.presetButtonsContainer},isEditEnabled:function t(){return this.isEditEnabledState},getEditButton:function t(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classEditButton)},getParam:function t(e,i){return e in this.params?this.params[e]:i},getFilter:function t(){return BX.Filter.Utils.getByClass(this.getPopup().contentContainer,this.settings.classFilterContainer)},getSearch:function t(){if(!(this.search instanceof BX.Filter.Search)){this.search=new BX.Filter.Search(this)}return this.search},_onRestoreButtonClick:function t(){var e={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("CONFIRM_MESSAGE"),CONFIRM_APPLY_BUTTON:this.getParam("CONFIRM_APPLY"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(e,BX.delegate(this.restoreFilter,this))},confirmDialog:function t(e,i,s){if("CONFIRM"in e&&e.CONFIRM){var n=this.getParam("FILTER_ID")+"-confirm-dialog";var a='<div class="main-ui-filter-confirm-content">'+e.CONFIRM_MESSAGE+"</div>";var r="CONFIRM_TITLE"in e?e.CONFIRM_TITLE:"";var l=new BX.PopupWindowButton({text:e.CONFIRM_APPLY_BUTTON,events:{click:function t(){BX.type.isFunction(i)?i():null;this.popupWindow.close();this.popupWindow.destroy()}}});var o=new BX.PopupWindowButtonLink({text:e.CONFIRM_CANCEL_BUTTON,events:{click:function t(){BX.type.isFunction(s)?s():null;this.popupWindow.close();this.popupWindow.destroy()}}});var u=new BX.PopupWindow(n,null,{content:a,titleBar:r,autoHide:false,zIndex:9999,overlay:.4,offsetTop:-100,closeIcon:true,closeByEsc:true,buttons:[l,o]});BX.addCustomEvent(u,"onPopupClose",BX.delegate(function(){!!this.getSaveForAllCheckbox()&&(this.getSaveForAllCheckbox().checked=null)},this));if(!u.isShown()){u.show();var c=u.popupContainer;BX.removeClass(c,this.settings.classAnimationShow);BX.addClass(c,this.settings.classAnimationShow)}}else{BX.type.isFunction(i)?i():null}},getInitialValue:function t(e){if(BX.type.isString(e)){var i=this.params.INITIAL_FILTER;if(BX.type.isPlainObject(i)){var s=Object.entries(i).reduce(function(t,i){if(i[0].startsWith(e)){t.push(i)}return t},[]);if(s.length===1){return s[0][1]}if(s.length>1){return s.reduce(function(t,i){t[i[0].replace(e,"")]=i[1];return t},{})}}}return""}}})();(function(){BX.Main.filterManager={data:{},push:function t(e,i){if(BX.type.isNotEmptyString(e)&&i){this.data[e]=i}},getById:function t(e){var i=null;if(e in this.data){i=this.data[e]}return i}}})();function i(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="main-ui-filter-additional-fields-container"></div>\n\t\t\t']);i=function e(){return t};return t}var s=function(t){babelHelpers.inherits(s,t);function s(t){var i;babelHelpers.classCallCheck(this,s);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this,t));i.id=t.NAME;i.parent=t.parent;i.node=t.node;i.options=babelHelpers.objectSpread({},t.options);i.cache=new e.Cache.MemoryCache;s.instances.set(i.node,babelHelpers.assertThisInitialized(i));return i}babelHelpers.createClass(s,[{key:"getAdditionalFieldContainer",value:function t(){return this.cache.remember("additionalFieldsContainer",function(){return e.Tag.render(i())})}},{key:"hasAdditional",value:function t(){return e.Dom.hasClass(this.node,"main-ui-filter-field-with-additional-fields")}},{key:"addAdditionalField",value:function t(i){if(!this.hasAdditional()){e.Dom.addClass(this.node,"main-ui-filter-field-with-additional-fields");e.Dom.append(this.getAdditionalFieldContainer(),this.node)}var n=this.parent.getPreset();var a=this.prepareFieldOptions(i);var r=n.createControl(a);this.appendRenderedField(r);return s.instances.get(r)}},{key:"prepareListItems",value:function t(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(e.Type.isPlainObject(i)){return Object.entries(i).map(function(t){var e=babelHelpers.slicedToArray(t,2),i=e[0],s=e[1];return{NAME:s,VALUE:i}})}return{}}},{key:"prepareFieldOptions",value:function t(i){var s=this;if(e.Type.isPlainObject(i)){var n=this.parent.params.FIELDS_STUBS;var a=i.type,r=a===void 0?"string":a;var l=n.find(function(t){return t.NAME===r});if(e.Type.isPlainObject(l)){var o=babelHelpers.objectSpread({},l,{NAME:i.id,LABEL:i.name,TYPE:r==="checkbox"?"SELECT":l.TYPE});if(r==="list"){return babelHelpers.objectSpread({},o,{ITEMS:[].concat(babelHelpers.toConsumableArray(o.ITEMS),[this.prepareListItems(i.items)]),params:{isMulti:function(){if(e.Type.isPlainObject(i.params)){return i.params===true}return false}()}})}if(r==="date"){var u=function(){if(e.Type.isPlainObject(i.value)&&Reflect.has(i.value,"_datesel")){return i.value._datesel}return s.parent.dateTypes.NONE}();return babelHelpers.objectSpread({},o,{SUB_TYPES:function(){if(e.Type.isArray(i.exclude)){return o.SUB_TYPES.filter(function(t){return!i.exclude.includes(t.VALUE)})}return o.SUB_TYPES}(),SUB_TYPE:function(){return o.SUB_TYPES.find(function(t){return t.VALUE===u})}(),VALUES:function(){if(e.Type.isPlainObject(i.value)){return babelHelpers.objectSpread({},i.value)}return o.VALUES}()})}if(r==="string"||r==="custom_date"||r==="number"||r==="checkbox"||r==="custom_entity"){return o}}}return i}},{key:"appendRenderedField",value:function t(i){if(e.Type.isDomNode(i)){var s=this.getAdditionalFieldContainer();e.Dom.append(i,s)}}},{key:"getValue",value:function t(){var e=this.parent.getFilterFieldsValues();var i=this.options,s=i.TYPE,n=i.NAME;if(s==="DATE"||s==="NUMBER"){return Object.entries(e).reduce(function(t,e){var i=babelHelpers.slicedToArray(e,2),s=i[0],a=i[1];if(s.startsWith(n)){t[s.replace(n,"")]=a}return t},{})}if(n in e){return e[n]}return""}}]);return s}(e.Event.EventEmitter);babelHelpers.defineProperty(s,"instances",new WeakMap);var n=function(){function t(e){babelHelpers.classCallCheck(this,t);this.parent=e}babelHelpers.createClass(t,[{key:"setFields",value:function t(i){if(e.Type.isPlainObject(i)){this.parent.getPopup();var s=this.parent.getPreset();s.deactivateAllPresets();var n={preset_id:"tmp_filter",fields:i};this.parent.updateParams(n);s.applyPreset("tmp_filter")}}},{key:"setFilter",value:function t(i){if(e.Type.isObject(i)){this.parent.updateParams(i);this.parent.getPreset().deactivateAllPresets();this.parent.getPreset().activatePreset(i.preset_id);this.parent.getPreset().applyPreset(i.preset_id);if(!i.checkFields||!this.parent.getPreset().isPresetValuesModified(i.preset_id)){this.parent.applyFilter(false,i.preset_id)}else{var s={};if(e.Type.isPlainObject(i.fields)){s=Object.assign({},i.fields)}if(e.Type.isPlainObject(i.additional)){s=Object.assign({},i.additional)}this.parent.getPreset().deactivateAllPresets();this.setFields(s);this.apply()}}}},{key:"extendFilter",value:function t(i){if(e.Type.isObject(i)){Object.keys(i).forEach(function(t){if(e.Type.isNumber(i[t])){i[t]="".concat(i[t])}});var s=this.parent.getPreset().getCurrentPresetId();if(s==="tmp_filter"||s==="default_filter"){var n=Object.assign({},this.parent.getFilterFieldsValues(),i);this.setFields(n);this.apply();return}var a=this.parent.getPreset().getAdditionalValues(s);if(e.Type.isPlainObject(a)&&Object.keys(a).length){i=Object.assign({},a,i)}this.setFilter({preset_id:s,additional:i,checkFields:true})}}},{key:"apply",value:function t(){if(!this.parent.isEditEnabled()){if(!this.parent.isEditEnabled()){this.parent.applyFilter()}this.parent.closePopup();if(this.parent.isAddPresetEnabled()){this.parent.disableAddPreset()}}}},{key:"getEmitter",value:function t(){return this.parent.emitter}}]);return t}();function a(t){return{block:"main-ui-control-field",type:t.type,dragButton:false,content:{block:"main-ui-date",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:t.placeholder,name:t.name,tabindex:t.tabindex,value:t.value,enableTime:t.enableTime}}}function r(t){return{block:"main-ui-control-field",type:t.type,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],valueDelete:true,placeholder:t.placeholder,name:t.name,tabindex:t.tabindex,value:t.value}}}function l(){return{block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}}}function o(t){return{block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:t.tabindex,value:t.value,items:t.items,name:t.name,valueDelete:false}}}function u(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div \n\t\t\t\tclass="main-ui-filter-error-message" \n\t\t\t\ttitle="','">\n\t\t\t\t'," ","\n\t\t\t</div>\n\t\t"]);u=function e(){return t};return t}var c=new WeakMap;var h=new WeakMap;var d=function(){function t(e){babelHelpers.classCallCheck(this,t);this.parent=null;this.init(e)}babelHelpers.createClass(t,[{key:"init",value:function t(e){this.parent=e;BX.addCustomEvent(window,"UI::Select::change",this._onDateTypeChange.bind(this))}},{key:"deleteField",value:function t(i){e.Dom.remove(i)}},{key:"isFieldDelete",value:function t(i){return e.Dom.hasClass(i,this.parent.settings.classFieldDelete)}},{key:"isFieldValueDelete",value:function t(i){return e.Dom.hasClass(i,this.parent.settings.classValueDelete)||e.Dom.hasClass(i.parentNode,this.parent.settings.classValueDelete)}},{key:"isDragButton",value:function t(i){return i&&e.Dom.hasClass(i,this.parent.settings.classPresetDragButton)}},{key:"clearFieldValue",value:function t(i){if(i){var s=babelHelpers.toConsumableArray(i.querySelectorAll(".main-ui-control"));var n=babelHelpers.toConsumableArray(i.querySelectorAll(".main-ui-square"));n.forEach(function(t){return e.Dom.remove(t)});s.forEach(function(t){if(Reflect.has(t,"value")){t.value=""}})}}},{key:"getField",value:function t(i){if(e.Type.isDomNode(i)){return i.closest(".main-ui-control-field, .main-ui-control-field-group")}return null}},{key:"render",value:function t(i,s){if(e.Type.isString(i)&&e.Type.isPlainObject(s)){var n=Object.entries(s).reduce(function(t,e){var i=babelHelpers.slicedToArray(e,2),s=i[0],n=i[1];return t.replace(new RegExp("{{".concat(s,"}}"),"g"),n)},i);var a=e.Dom.create("div",{html:n});var r=a.querySelector(".main-ui-control-field-group");if(r){return r}var l=a.querySelector(".main-ui-control-field");if(l){return l}var o=a.querySelector(".main-ui-filter-field-line");if(o){return o}}return null}},{key:"createInputText",value:function t(i){var n={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:i.NAME,type:i.TYPE,label:this.parent.getParam("ENABLE_LABEL")?i.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:[{block:"main-ui-control-string",name:i.NAME,placeholder:i.PLACEHOLDER||"",value:e.Type.isString(i.VALUE)||e.Type.isNumber(i.VALUE)?i.VALUE:"",tabindex:i.TABINDEX}]};var a=BX.decl(n);this.parent.getEmitter().emit("BX.Filter.Field:init",{field:new s({parent:this.parent,options:babelHelpers.objectSpread({},i),node:a})});return a}},{key:"createTextarea",value:function t(i){var n=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:i.NAME,type:i.TYPE,label:this.parent.getParam("ENABLE_LABEL")?i.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:[{block:"main-ui-control-textarea",name:i.NAME,placeholder:i.PLACEHOLDER||"",value:e.Type.isString(i.VALUE)||e.Type.isNumber(i.VALUE)?i.VALUE:"",tabindex:i.TABINDEX}]});var a=n.querySelector("textarea");var r=function t(){e.Dom.style(a,"height","1px");e.Dom.style(a,"height","".concat(a.scrollHeight,"px"))};e.Event.bind(a,"input",r);e.Event.bind(a,"change",r);e.Event.bind(a,"keyup",r);e.Event.bind(a,"cut",r);e.Event.bind(a,"paste",r);this.parent.getEmitter().emit("BX.Filter.Field:init",{field:new s({parent:this.parent,options:babelHelpers.objectSpread({},i),node:n})});return n}},{key:"createDestSelector",value:function t(i){var n={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:i.NAME,type:i.TYPE,label:this.parent.getParam("ENABLE_LABEL")?i.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-control-entity",mix:"main-ui-control",attrs:{"data-multiple":JSON.stringify(i.MULTIPLE)},content:[]}};if("_label"in i.VALUES&&!!i.VALUES._label){if(i.MULTIPLE){var a=i.VALUES._label?i.VALUES._label:[];if(e.Type.isPlainObject(a)){a=Object.keys(a).map(function(t){return a[t]})}if(!e.Type.isArray(a)){a=[a]}var r=i.VALUES._value?i.VALUES._value:[];if(e.Type.isPlainObject(r)){r=Object.keys(r).map(function(t){return r[t]})}if(!e.Type.isArray(r)){r=[r]}a.forEach(function(t,e){n.content.content.push({block:"main-ui-square",tag:"span",name:t,item:{_label:t,_value:r[e]}})})}else{n.content.content.push({block:"main-ui-square",tag:"span",name:"_label"in i.VALUES?i.VALUES._label:"",item:i.VALUES})}}n.content.content.push({block:"main-ui-square-search",tag:"span",content:{block:"main-ui-control-string",name:"".concat(i.NAME,"_label"),tabindex:i.TABINDEX,type:"text",placeholder:i.PLACEHOLDER||""}},{block:"main-ui-control-string",name:i.NAME,type:"hidden",placeholder:i.PLACEHOLDER||"",value:"_value"in i.VALUES?i.VALUES._value:"",tabindex:i.TABINDEX});n=BX.decl(n);var l=BX.Filter.Utils.getBySelector(n,'.main-ui-control-string[type="text"]');BX.addClass(l,"main-ui-square-search-item");e.Event.bind(l,"focus",function(t){BX.fireEvent(t.currentTarget,"click")});e.Event.bind(l,"click",BX.proxy(this._onCustomEntityInputClick,this));if(!this.bindDocument){e.Event.bind(document,"click",BX.proxy(this._onCustomEntityBlur,this));document.addEventListener("focus",BX.proxy(this._onDocumentFocus,this),true);this.bindDocument=true}e.Event.bind(l,"keydown",BX.proxy(this._onCustomEntityKeydown,this));e.Event.bind(n,"click",BX.proxy(this._onCustomEntityFieldClick,this));BX.ready(BX.proxy(function(){BX.Filter.DestinationSelector.create(i.NAME,{filterId:this.parent.getParam("FILTER_ID"),fieldId:i.NAME})},this));this.parent.getEmitter().emit("BX.Filter.Field:init",{field:new s({parent:this.parent,options:babelHelpers.objectSpread({},i),node:n})});return n}},{key:"createCustomEntity",value:function t(i){var n={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:i.NAME,type:i.TYPE,label:this.parent.getParam("ENABLE_LABEL")?i.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-control-entity",mix:"main-ui-control",attrs:{"data-multiple":JSON.stringify(i.MULTIPLE)},content:[]}};if("_label"in i.VALUES&&!!i.VALUES._label){if(i.MULTIPLE){var a=i.VALUES._label?i.VALUES._label:[];if(e.Type.isPlainObject(a)){a=Object.keys(a).map(function(t){return a[t]})}if(!e.Type.isArray(a)){a=[a]}var r=i.VALUES._value?i.VALUES._value:[];if(e.Type.isPlainObject(r)){r=Object.keys(r).map(function(t){return r[t]})}if(!e.Type.isArray(r)){r=[r]}a.forEach(function(t,e){n.content.content.push({block:"main-ui-square",tag:"span",name:t,item:{_label:t,_value:r[e]}})})}else{n.content.content.push({block:"main-ui-square",tag:"span",name:"_label"in i.VALUES?i.VALUES._label:"",item:i.VALUES})}}n.content.content.push({block:"main-ui-square-search",tag:"span",content:{block:"main-ui-control-string",name:"".concat(i.NAME,"_label"),tabindex:i.TABINDEX,type:"text",placeholder:i.PLACEHOLDER||""}},{block:"main-ui-control-string",name:i.NAME,type:"hidden",placeholder:i.PLACEHOLDER||"",value:"_value"in i.VALUES?i.VALUES._value:"",tabindex:i.TABINDEX});n=BX.decl(n);var l=BX.Filter.Utils.getBySelector(n,'.main-ui-control-string[type="text"]');BX.addClass(l,"main-ui-square-search-item");e.Event.bind(l,"focus",BX.proxy(this._onCustomEntityInputFocus,this));e.Event.bind(l,"click",BX.proxy(this._onCustomEntityInputClick,this));if(!this.bindDocument){e.Event.bind(document,"click",BX.proxy(this._onCustomEntityBlur,this));document.addEventListener("focus",BX.proxy(this._onDocumentFocus,this),true);this.bindDocument=true}e.Event.bind(l,"keydown",BX.proxy(this._onCustomEntityKeydown,this));e.Event.bind(n,"click",BX.proxy(this._onCustomEntityFieldClick,this));this.parent.getEmitter().emit("BX.Filter.Field:init",{field:new s({parent:this.parent,options:babelHelpers.objectSpread({},i),node:n})});return n}},{key:"_onCustomEntityInputFocus",value:function t(e){BX.fireEvent(e.currentTarget,"click")}},{key:"_onCustomEntityInputClick",value:function t(e){e.preventDefault();e.stopPropagation();if(e.isTrusted){this.trustTimestamp=e.timeStamp;this.notTrustTimestamp=this.notTrustTimestamp||e.timeStamp}else{this.notTrustTimestamp=e.timeStamp}var i=new Date(this.trustTimestamp);var s=new Date(this.notTrustTimestamp);var n="".concat(i.getMinutes(),":").concat(i.getSeconds());var a="".concat(s.getMinutes(),":").concat(s.getSeconds());if(n!==a){this._onCustomEntityFocus(e)}}},{key:"_onDocumentFocus",value:function t(e){var i=this.getCustomEntityInstance();var s=i.getPopupContainer();var n=i.getLabelNode()===e.target;var a=!!s&&s.contains(e.target);if(!n&&!a){this._onCustomEntityBlur(e)}}},{key:"_onCustomEntityKeydown",value:function t(i){var s=i.target,n=i.currentTarget;var a=s.parentNode.parentNode;var r=a.querySelectorAll(".main-ui-square");var l=r[r.length-1];if(!e.Type.isDomNode(l)){return}if(BX.Filter.Utils.isKey(i,"backspace")&&n.selectionStart===0){if(e.Dom.hasClass(l,"main-ui-square-selected")){var o=a.querySelector('input[type="hidden"]');if(e.Type.isDomNode(o)){o.value="";BX.fireEvent(o,"input")}e.Dom.remove(l);return}e.Dom.addClass(l,"main-ui-square-selected");return}e.Dom.removeClass(l,"main-ui-square-selected")}},{key:"_onCustomEntityFieldClick",value:function t(i){var s=i.target;if(e.Dom.hasClass(s,"main-ui-square-delete")){var n=s.closest(".main-ui-square");if(e.Type.isDomNode(n)){var a=this.getCustomEntityInstance();BX.onCustomEvent(window,"BX.Main.Filter:customEntityRemove",[a]);e.Dom.remove(n)}return}var r=s.querySelector('input[type="text"]');if(e.Type.isDomNode(r)){BX.fireEvent(r,"focus")}}},{key:"_onCustomEntityBlur",value:function t(i){var s={stopBlur:false};BX.onCustomEvent(window,"BX.Main.Filter:onGetStopBlur",[i,s]);if(typeof s.stopBlur==="undefined"||!s.stopBlur){var n=this.getCustomEntityInstance();BX.onCustomEvent(window,"BX.Main.Filter:customEntityBlur",[n]);e.Event.unbind(n.getPopupContainer(),"click",this._stopPropagation);e.Dom.removeClass(n.getField(),"main-ui-focus")}}},{key:"_stopPropagation",value:function t(e){e.stopPropagation()}},{key:"getCustomEntityInstance",value:function t(){if(!(this.customEntityInstance instanceof BX.Main.ui.CustomEntity)){this.customEntityInstance=new BX.Main.ui.CustomEntity}return this.customEntityInstance}},{key:"_onCustomEntityFocus",value:function t(i){i.stopPropagation();var s=i.currentTarget;var n=s.closest(".main-ui-control-entity");var a=this.getCustomEntityInstance();a.setField(n);BX.onCustomEvent("BX.Main.Filter:customEntityFocus",[a]);var r=a.getPopupContainer();if(e.Type.isElementNode(r)){e.Event.bind(r,"click",this._stopPropagation)}e.Dom.addClass(n,"main-ui-focus")}},{key:"createCustom",value:function t(i){var n=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:i.NAME,type:i.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?i.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-custom",mix:["main-ui-control","main-ui-custom-style"],attrs:{"data-name":i.NAME},content:""}});if(e.Type.isString(i.VALUE)){var a=function(){if(Reflect.has(i,"_VALUE")){return i._VALUE}return""}();var r=e.Text.encode(i.VALUE).replace('name="'.concat(i.NAME,'"'),'name="'.concat(i.NAME,'" value="').concat(a,'"'));var l=n.querySelector(".main-ui-custom");e.Runtime.html(l,r)}this.parent.getEmitter().emit("BX.Filter.Field:init",{field:new s({parent:this.parent,options:babelHelpers.objectSpread({},i),node:n})});return n}},{key:"createSelect",value:function t(e){var i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:e.NAME,type:e.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?e.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:this.parent.settings.classSelect,name:e.NAME,items:e.ITEMS,value:"VALUE"in e?e.VALUE:e.ITEMS[0],params:e.PARAMS,tabindex:e.TABINDEX,valueDelete:false}});this.parent.getEmitter().emit("BX.Filter.Field:init",{field:new s({parent:this.parent,options:babelHelpers.objectSpread({},e),node:i})});return i}},{key:"createMultiSelect",value:function t(e){var i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:e.NAME,type:e.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?e.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-multi-select",name:e.NAME,tabindex:"TABINDEX"in e?e.TABINDEX:"",placeholder:!this.parent.getParam("ENABLE_LABEL")&&"PLACEHOLDER"in e?e.PLACEHOLDER:"",items:"ITEMS"in e?e.ITEMS:[],value:"VALUE"in e?e.VALUE:[],params:"PARAMS"in e?e.PARAMS:{isMulti:true},valueDelete:true}});this.parent.getEmitter().emit("BX.Filter.Field:init",{field:new s({parent:this.parent,options:babelHelpers.objectSpread({},e),node:i})});return i}},{key:"createCustomDate",value:function t(i){var n={block:"main-ui-control-field-group",type:i.TYPE,mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel,"main-ui-filter-date-group"]:["main-ui-filter-date-group"],label:this.parent.getParam("ENABLE_LABEL")?i.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:"TABINDEX"in i?i.TABINDEX:"",name:"NAME"in i?i.NAME:"",deleteButton:true,content:[]};if(e.Type.isPlainObject(i.VALUE.days)){i.VALUE.days=Object.keys(i.VALUE.days).map(function(t){return i.VALUE.days[t]})}var a=i.DAYS.filter(function(t){return i.VALUE.days.some(function(e){return e===t.VALUE})});var r={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],placeholder:i.DAYS_PLACEHOLDER,dragButton:false,content:{block:"main-ui-multi-select",name:"".concat(i.NAME,"_days"),tabindex:"TABINDEX"in i?i.TABINDEX:"",items:i.DAYS,value:a,params:"PARAMS"in i?i.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":i.DAYS_PLACEHOLDER}}};if(e.Type.isPlainObject(i.VALUE.months)){i.VALUE.months=Object.keys(i.VALUE.months).map(function(t){return i.VALUE.months[t]})}var l=i.MONTHS.filter(function(t){return i.VALUE.months.some(function(e){return e===t.VALUE})});var o={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],dragButton:false,content:{block:"main-ui-multi-select",name:"".concat(i.NAME,"_months"),tabindex:"TABINDEX"in i?i.TABINDEX:"",items:i.MONTHS,value:l,params:"PARAMS"in i?i.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":i.MONTHS_PLACEHOLDER}}};if(e.Type.isPlainObject(i.VALUE.years)){i.VALUE.years=Object.keys(i.VALUE.years).map(function(t){return i.VALUE.years[t]})}var u=i.YEARS.filter(function(t){return i.VALUE.years.some(function(e){return e===t.VALUE})});var c={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],dragButton:false,content:{block:"main-ui-multi-select",name:"".concat(i.NAME,"_years"),tabindex:"TABINDEX"in i?i.TABINDEX:"",items:i.YEARS,value:u,params:"PARAMS"in i?i.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":i.YEARS_PLACEHOLDER}}};n.content.push(r);n.content.push(o);n.content.push(c);var h=BX.decl(n);this.parent.getEmitter().emit("BX.Filter.Field:init",{field:new s({parent:this.parent,options:babelHelpers.objectSpread({},i),node:h})});return h}},{key:"_onDateTypeChange",value:function t(i,s){var n=this;if(this.parent.getPopup().contentContainer.contains(i.node)){var a={};var r=null;var l;var o;var u;if(e.Type.isPlainObject(s)&&Reflect.has(s,"VALUE")){var c=i.getNode();var h=i.getParams();var d=c.dataset.name;if(!e.Type.isPlainObject(h)&&(d.endsWith("_datesel")||d.endsWith("_numsel"))){var p=c.parentNode.parentNode;a.TABINDEX=i.getInput().getAttribute("tabindex");a.SUB_TYPES=i.getItems();a.SUB_TYPE=s;a.NAME=p.dataset.name;a.TYPE=p.dataset.type;var f=this.parent.getPreset().getCurrentPresetData();if(e.Type.isArray(f.FIELDS)){var m=f.FIELDS.find(function(t){return t.NAME===a.NAME});if(e.Type.isNil(m)){m=this.parent.params.FIELDS_STUBS.find(function(t){return t.TYPE===a.TYPE})}if(!e.Type.isNil(m)){if(d.endsWith("_datesel")){a.MONTHS=m.MONTHS;a.MONTH=m.MONTH;a.YEARS=m.YEARS;a.YEAR=m.YEAR;a.QUARTERS=m.QUARTERS;a.QUARTER=m.QUARTER;a.ENABLE_TIME=m.ENABLE_TIME;a.YEARS_SWITCHER=m.YEARS_SWITCHER}a.VALUES=m.VALUES}}if(this.parent.getParam("ENABLE_LABEL")){l=p.querySelector(".main-ui-control-field-label");a.LABEL=l.innerText}if(d.endsWith("_datesel")){r=this.createDate(a)}else{r=this.createNumber(a)}if(e.Type.isArray(this.parent.fieldsList)){u=this.parent.fieldsList.indexOf(p);if(u!==-1){this.parent.fieldsList[u]=r;this.parent.registerDragItem(r)}}this.parent.unregisterDragItem(p);o=babelHelpers.toConsumableArray(r.querySelectorAll(".main-ui-control-field"));if(e.Type.isArray(o)&&o.length){o.forEach(function(t){t.FieldController=new BX.Filter.FieldController(t,n.parent)})}e.Dom.insertAfter(r,p);e.Dom.remove(p)}}}}},{key:"createNumber",value:function t(e){var i=this.parent.numberTypes;var n=this.parent.params.ENABLE_LABEL;var a=e.SUB_TYPE,r=a===void 0?{}:a,l=e.SUB_TYPES,o=l===void 0?[]:l,u=e.TABINDEX,c=u===void 0?"":u,h=e.VALUES,d=h===void 0?{_from:"",_to:""}:h,p=e.LABEL,f=p===void 0?"":p,m=e.TYPE;var E=r.VALUE||i.SINGLE;var g=r.PLACEHOLDER||"";var B=e.NAME.replace("_numsel","");var y=function(){if(n){return["main-ui-filter-wield-with-label","main-ui-filter-number-group"]}return["main-ui-filter-number-group"]}();var A={block:"number-group",type:m,mix:y,label:n?f:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:c,value:r,items:o,name:B,deleteButton:true,content:[]};if(E!==i.LESS){var v={block:"main-ui-control-field",type:m,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:g,name:"".concat(B,"_from"),tabindex:c,value:d._from||""}};A.content.push(v)}if(E===i.RANGE){var P={block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}};A.content.push(P)}if(E===i.RANGE||E===i.LESS){var _={block:"main-ui-control-field",type:m,dragButton:false,content:{block:"main-ui-number",calendarButton:true,valueDelete:true,name:"".concat(B,"_to"),tabindex:c,value:d._to||""}};A.content.push(_)}var S=BX.decl(A);this.parent.getEmitter().emit("BX.Filter.Field:init",{field:new s({parent:this.parent,options:babelHelpers.objectSpread({},e),node:S})});return S}},{key:"createDate",value:function t(i){var n=this;var u=this.parent,c=u.dateTypes,h=u.additionalDateTypes;var d=i.SUB_TYPE,p=d===void 0?{}:d,f=i.SUB_TYPES,m=f===void 0?[]:f,E=i.PLACEHOLDER,g=E===void 0?"":E,B=i.VALUES,y=B===void 0?{_from:"",_to:"",_quarter:"",_days:"",_month:"",_year:"",_allow_year:""}:B,A=i.TABINDEX,v=A===void 0?"":A,P=i.ENABLE_TIME,_=P===void 0?false:P,S=i.LABEL,L=S===void 0?"":S,b=i.TYPE;var X=this.parent.params.ENABLE_LABEL;var T=p.VALUE||c.NONE;var I=i.NAME.replace("_datesel","");var F=function(){if(X){return["main-ui-filter-wield-with-label","main-ui-filter-date-group"]}return["main-ui-filter-date-group"]}();var D={block:"date-group",type:b,mix:F,label:X?L:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:v,value:p,items:m,name:I,enableTime:_,deleteButton:true,content:[]};if(T===c.EXACT){var C=a({type:b,name:"".concat(I.NAME,"_from"),placeholder:g,tabindex:v,value:y._from||"",enableTime:_});D.content.push(C)}if(T===c.NEXT_DAYS||T===c.PREV_DAYS||T===h.PREV_DAY||T===h.NEXT_DAY||T===h.MORE_THAN_DAYS_AGO||T===h.AFTER_DAYS){var U=r({type:b,name:"".concat(I,"_days"),tabindex:v,value:y._days||"",placeholder:g});D.content.push(U)}if(T===c.RANGE){var N={block:"main-ui-filter-range-group",content:[a({type:b,name:"".concat(I,"_from"),placeholder:g,tabindex:v,value:y._from||"",enableTime:_}),l(),a({type:b,name:"".concat(I,"_to"),placeholder:g,tabindex:v,value:y._to||"",enableTime:_})]};D.content.push(N)}if(T===c.MONTH){var R=i.MONTHS,k=i.MONTH,O=i.YEARS,M=i.YEAR;var V=R.find(function(t){return t.VALUE===y._month})||k||R[0];var x=O.find(function(t){return t.VALUE===y._year})||M||O[0];D.content.push(o({name:"".concat(I,"_month"),value:V,items:R,tabindex:v}),o({name:"".concat(I,"_year"),value:x,items:O,tabindex:v}))}if(T===c.QUARTER){var w=i.YEARS,q=i.YEAR,j=i.QUARTERS,Y=i.QUARTER,H=i.PARAMS;var G=w.find(function(t){return t.VALUE===y._year})||q||w[0];var W=j.find(function(t){return t.VALUE===y._quarter})||Y||j[0];D.content.push(o({name:"".concat(I,"_year"),value:G,items:w,tabindex:v}),o({name:"".concat(I,"_quarter"),value:W,items:j,tabindex:v,params:H}))}if(T===c.YEAR){var K=i.YEARS,Q=i.YEAR;var J=K.find(function(t){return t.VALUE===y._year})||Q||K[0];D.content.push(o({name:"".concat(I,"_year"),value:J,items:K,tabindex:v}))}if(T==="CUSTOM_DATE"){var z=m.find(function(t){return t.VALUE==="CUSTOM_DATE"});if(z){var Z=e.Runtime.clone(z.DECL);if(e.Type.isArray(y._days)){Z.VALUE.days=y._days}if(e.Type.isArray(y._month)){Z.VALUE.months=y._month}if(e.Type.isArray(y._year)){Z.VALUE.years=y._year}Z.mix=Z.filter(function(t){return t!=="main-ui-filter-wield-with-label"});var $=this.createCustomDate(Z);var tt=babelHelpers.toConsumableArray($.querySelectorAll(".main-ui-item-icon-container, .main-ui-filter-icon-grab"));tt.forEach(function(t){return e.Dom.remove(t)});D.content.push($);D.push("main-ui-filter-custom-date-group")}}if(T!==c.NONE&&T!==h.CUSTOM_DATE&&i.YEARS_SWITCHER){var et=e.Runtime.clone(i.YEARS_SWITCHER);var it=et.ITEMS;et.VALUE=it.reduce(function(t,e){return e.VALUE===y._allow_year?e:t});var st=this.createSelect(et);e.Dom.addClass(st,["main-ui-filter-year-switcher","main-ui-filter-with-padding"]);e.Dom.removeClass(st,"main-ui-filter-wield-with-label");var nt=babelHelpers.toConsumableArray(st.querySelectorAll(".main-ui-item-icon-container, .main-ui-filter-icon-grab"));nt.forEach(function(t){return e.Dom.remove(t)});var at=D.content.length-1;var rt=D.content[at];if(e.Type.isPlainObject(rt)){if(!e.Type.isArray(rt.mix)){rt.mix=[]}rt.mix.push("main-ui-filter-remove-margin-right")}if(e.Type.isDomNode(rt)){e.Dom.addClass(rt,"main-ui-filter-remove-margin-right")}requestAnimationFrame(function(){e.Dom.addClass(st.previousElementSibling,"main-ui-filter-remove-margin-right")});D.content.push(st);D.mix.push("main-ui-filter-date-with-years-switcher")}var lt=BX.decl(D);var ot=e.Runtime.debounce(this.onDateChange,500,this);var ut=babelHelpers.toConsumableArray(lt.querySelectorAll(".main-ui-date-input"));ut.forEach(function(t){t.addEventListener("change",ot);t.addEventListener("input",ot);var e=t.parentNode;var i=e.querySelector(".main-ui-control-value-delete");if(i){i.addEventListener("click",function(){setTimeout(function(){n.onDateChange({target:t})})})}});this.parent.getEmitter().emit("BX.Filter.Field:init",{field:new s({parent:this.parent,options:babelHelpers.objectSpread({},i),node:lt})});return lt}},{key:"onDateChange",value:function t(e){var i=this;if(h.get(e.target)===e.target.value){return}h.set(e.target,e.target.value);if(e.target.value===""){this.hideDateError(e.target);return}BX.ajax.runComponentAction("bitrix:main.ui.filter","checkDateFormat",{mode:"ajax",data:{value:e.target.value,format:BX.message("FORMAT_DATETIME")}}).then(function(t){if(!t.data.result){i.showDateError(e.target);return}i.hideDateError(e.target)})}},{key:"showDateError",value:function t(i){e.Dom.style(i,"border-color","#FF5752");if(c.has(i)){e.Dom.remove(c.get(i))}var s=this.parent.params,n=s.MAIN_UI_FILTER__DATE_ERROR_TITLE,a=s.MAIN_UI_FILTER__DATE_ERROR_LABEL;var r=e.Tag.render(u(),n,a,e.Loc.getMessage("FORMAT_DATE"));c.set(i,r);e.Dom.insertAfter(r,i);e.Dom.attr(i,"is-valid","false")}},{key:"hideDateError",value:function t(i){e.Dom.style(i,"border-color",null);if(c.has(i)){e.Dom.remove(c.get(i))}e.Dom.attr(i,"is-valid","true")}}]);return t}();var p=function(){function t(e){babelHelpers.classCallCheck(this,t);this.parent=null;this.presets=null;this.container=null;this.init(e)}babelHelpers.createClass(t,[{key:"init",value:function t(e){this.parent=e}},{key:"bindOnPresetClick",value:function t(){var i=this;(this.getPresets()||[]).forEach(function(t){e.Event.bind(t,"click",BX.delegate(i._onPresetClick,i))})}},{key:"getAddPresetField",value:function t(){return this.getContainer().querySelector(".main-ui-filter-new-filter")}},{key:"getAddPresetFieldInput",value:function t(){return this.getAddPresetField().querySelector(".main-ui-filter-sidebar-edit-control")}},{key:"clearAddPresetFieldInput",value:function t(){var i=this.getAddPresetFieldInput();if(e.Type.isDomNode(i)){i.value=""}}},{key:"normalizePreset",value:function t(e){return e.closest(".main-ui-filter-sidebar-item")}},{key:"deactivateAllPresets",value:function t(){this.getPresets().forEach(function(t){e.Dom.removeClass(t,"main-ui-filter-current-item")})}},{key:"createSidebarItem",value:function t(i,s,n){return BX.decl({block:"sidebar-item",text:e.Text.decode(s),id:i,pinned:n,noEditPinTitle:this.parent.getParam("MAIN_UI_FILTER__IS_SET_AS_DEFAULT_PRESET"),editNameTitle:this.parent.getParam("MAIN_UI_FILTER__EDIT_PRESET_TITLE"),removeTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_PRESET"),editPinTitle:this.parent.getParam("MAIN_UI_FILTER__SET_AS_DEFAULT_PRESET"),dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_TITLE")})}},{key:"activatePreset",value:function t(i){var s=this;this.deactivateAllPresets();var n=function(){if(e.Type.isString(i)){return s.getPresetNodeById(i)}return i}();if(e.Type.isDomNode(n)){e.Dom.addClass(n,"main-ui-filter-current-item")}}},{key:"getPresetNodeById",value:function t(i){return this.getPresets().find(function(t){return e.Dom.attr(t,"data-id")===i})}},{key:"getPresetId",value:function t(i){return e.Dom.attr(i,"data-id")}},{key:"updatePresetName",value:function t(i,s){if(e.Type.isDomNode(i)&&e.Type.isString(s)&&s!==""){var n=this.getPresetNameNode(i);if(e.Type.isDomNode(n)){e.Runtime.html(n,s)}}}},{key:"removePreset",value:function t(e,i,s){var n=this.getCurrentPresetId();var a=[];var r={preset_id:i,is_default:s};var l={FILTER_ID:this.parent.getParam("FILTER_ID"),action:"REMOVE_FILTER"};this.parent.saveOptions(r,l);BX.remove(e);if(BX.type.isArray(this.parent.params.PRESETS)){a=this.parent.params.PRESETS.filter(function(t){return t.ID!==i},this);this.parent.params.PRESETS=a}if(BX.type.isArray(this.parent.editablePresets)){a=this.parent.editablePresets.filter(function(t){return t.ID!==i},this);this.parent.editablePresets=a}if(i===n){this.parent.getSearch().removePreset();this.resetPreset()}}},{key:"pinPreset",value:function t(i){if(!BX.type.isNotEmptyString(i)){i="default_filter"}var s=this.getPresetNodeById(i);if(this.parent.getParam("VALUE_REQUIRED_MODE")){if(i==="default_filter"){return}}var n={FILTER_ID:this.parent.getParam("FILTER_ID"),GRID_ID:this.parent.getParam("GRID_ID"),action:"PIN_PRESET"};var a={preset_id:i};this.getPresets().forEach(function(t){e.Dom.removeClass(t,this.parent.settings.classPinnedPreset)},this);BX.addClass(s,this.parent.settings.classPinnedPreset);this.parent.saveOptions(a,n)}},{key:"_onPresetClick",value:function t(i){var s;var n;var a;var r;var l;var o;var u;i.preventDefault();u=this.parent;o=u.settings;l=i.target;s=i.currentTarget;n=this.getPresetId(s);a=this.getPreset(n);if(e.Dom.hasClass(l,o.classPinButton)){if(this.parent.isEditEnabled()){if(e.Dom.hasClass(s,o.classPinnedPreset)){this.pinPreset("default_filter")}else{this.pinPreset(n)}}}if(e.Dom.hasClass(l,o.classPresetEditButton)){this.enableEditPresetName(s)}if(e.Dom.hasClass(l,o.classPresetDeleteButton)){r="IS_DEFAULT"in a?a.IS_DEFAULT:false;this.removePreset(s,n,r);return false}if(!e.Dom.hasClass(l,o.classPresetDragButton)&&!e.Dom.hasClass(l,o.classAddPresetFieldInput)){if(this.parent.isEditEnabled()){this.updateEditablePreset(this.getCurrentPresetId())}var c=this.getPreset(this.getCurrentPresetId());var h=this.getPreset(n);c.ADDITIONAL=[];h.ADDITIONAL=[];this.activatePreset(s);this.applyPreset(n);if(!this.parent.isEditEnabled()){u.applyFilter(null,true);if(i.isTrusted){u.closePopup()}if(u.isAddPresetEnabled()){u.disableAddPreset()}}}}},{key:"applyPinnedPreset",value:function t(){var e=this.parent;var i=this.isPinned(this.getCurrentPresetId());var s;if(this.parent.getParam("VALUE_REQUIRED")&&this.getPinnedPresetId()==="default_filter"){this.applyPreset("default_filter");this.deactivateAllPresets();s=this.parent.applyFilter()}else if(!i){var n=this.getPinnedPresetId();var a=this.getPinnedPresetNode();var r=false;var l=true;this.deactivateAllPresets();this.activatePreset(a);this.applyPreset(n);s=e.applyFilter(r,l);e.closePopup()}else{s=e.resetFilter()}return s}},{key:"updateEditablePreset",value:function t(e){var i=this.parent.getFilterFieldsValues();var s=this.getFields().map(function(t){return BX.data(t,"name")});var n=this.parent.preparePresetFields(i,s);var a=this.getPreset(e);a.FIELDS=n;a.TITLE=this.getPresetInput(this.getPresetNodeById(e)).value;a.ROWS=s}},{key:"getPresetInput",value:function t(e){return BX.Filter.Utils.getByClass(e,this.parent.settings.classPresetEditInput)}},{key:"enableEditPresetName",value:function t(i){var s=this.getPresetInput(i);BX.addClass(i,this.parent.settings.classPresetNameEdit);s.focus();s.value=BX.util.htmlspecialcharsback(s.value);e.Event.bind(s,"input",BX.delegate(this._onPresetNameInput,this))}},{key:"_onPresetNameInput",value:function t(e){var i=this.parent.getSearch();var s=e.currentTarget.value;var n=BX.findParent(e.currentTarget,{className:this.parent.settings.classPreset},true,false);var a=this.getPresetId(n);var r=this.getCurrentPresetId();var l={ID:a,TITLE:s};if(a===r){i.updatePreset(l)}}},{key:"getPresetNameNode",value:function t(e){return BX.Filter.Utils.getByClass(e,this.parent.settings.classPresetName)}},{key:"disableEditPresetName",value:function t(i){var s=this.getPresetInput(i);e.Dom.removeClass(i,this.parent.settings.classPresetNameEdit);if(BX.type.isDomNode(s)){s.blur();BX.unbind(s,"input",BX.delegate(this._onPresetNameInput,this))}}},{key:"getPreset",value:function t(e,i){var s=this.parent.getParam(i?"DEFAULT_PRESETS":"PRESETS",[]);if(this.parent.isEditEnabled()&&!i){s=this.parent.editablePresets}var n=s.filter(function(t){return t.ID===e});if(e==="tmp_filter"&&!n.length){var a=BX.clone(this.getPreset("default_filter"));a.ID="tmp_filter";s.push(a);n.push(a)}return n.length!==0?n[0]:null}},{key:"getPresetField",value:function t(e,i){var s=this.getPreset(e);var n=null;if(BX.type.isPlainObject(s)&&"FIELDS"in s&&BX.type.isArray(s.FIELDS)){n=s.FIELDS.filter(function(t){return t.NAME===i});n=n.length?n[0]:null}return n}},{key:"applyPreset",value:function t(e,i){e=i?"default_filter":e||"default_filter";var s=this.getPreset(e);if(e!=="default_preset"){s=this.extendPreset(s)}this.parent.getSearch().updatePreset(s);this.updatePresetFields(s,i)}},{key:"extendPreset",value:function t(e){var i=BX.clone(this.getPreset("default_filter"));if(BX.type.isPlainObject(e)){e=BX.clone(e);e.FIELDS.forEach(function(t){var e;var s=i.FIELDS.some(function(i,s){var n=false;if(i.NAME===t.NAME){e=s;n=true}return n},this);if(s&&e||s&&e===0){i.FIELDS[e]=t}else if(!this.isEmptyField(t)){i.FIELDS.push(t)}},this);e.FIELDS=i.FIELDS}return e}},{key:"isEmptyField",value:function t(e){var i=true;if(e.TYPE===this.parent.types.STRING){if(e.VALUE&&e.VALUE.length){i=false}}if(e.TYPE===this.parent.types.SELECT){if(BX.type.isPlainObject(e.VALUE)&&"VALUE"in e.VALUE&&e.VALUE.VALUE){i=false}}if(e.TYPE===this.parent.types.MULTI_SELECT){if(BX.type.isArray(e.VALUE)&&e.VALUE.length){i=false}}if(e.TYPE===this.parent.types.CUSTOM_DATE){if(BX.type.isArray(e.VALUE.days)&&e.VALUE.days.length||BX.type.isArray(e.VALUE.months)&&e.VALUE.months.length||BX.type.isArray(e.VALUE.years)&&e.VALUE.years.length){i=false}}if(e.TYPE===this.parent.types.CUSTOM_ENTITY||e.TYPE===this.parent.types.DEST_SELECTOR){if(BX.type.isPlainObject(e.VALUES)){if(BX.type.isNotEmptyString(e.VALUES._label)&&BX.type.isNotEmptyString(e.VALUES._value)){i=false}if(BX.type.isPlainObject(e.VALUES._label)&&BX.type.isPlainObject(e.VALUES._value)&&Object.keys(e.VALUES._label).length&&Object.keys(e.VALUES._value).length){i=false}if(BX.type.isArray(e.VALUES._label)&&BX.type.isArray(e.VALUES._value)&&e.VALUES._label.length&&e.VALUES._value.length){i=false}if((BX.type.isArray(e.VALUES._label)&&e.VALUES._label.length||BX.type.isPlainObject(e.VALUES._label)&&Object.keys(e.VALUES._label).length)&&(BX.type.isArray(e.VALUES._value)&&e.VALUES._value.length||BX.type.isPlainObject(e.VALUES._value)&&Object.keys(e.VALUES._value).length)){i=false}}}if(e.TYPE===this.parent.types.DATE){var s="_datesel"in e.VALUES?e.VALUES._datesel:e.SUB_TYPE.VALUE;if(BX.type.isPlainObject(e.VALUES)&&(e.VALUES._from||e.VALUES._to||e.VALUES._quarter||e.VALUES._month&&!BX.type.isArray(e.VALUES._month)||e.VALUES._year&&!BX.type.isArray(e.VALUES._year)||e.VALUES._days&&!BX.type.isArray(e.VALUES._days))||BX.type.isArray(e.VALUES._days)&&e.VALUES._days.length||BX.type.isArray(e.VALUES._month)&&e.VALUES._month.length||BX.type.isArray(e.VALUES._year)&&e.VALUES._year.length||s===this.parent.dateTypes.CURRENT_DAY||s===this.parent.dateTypes.CURRENT_WEEK||s===this.parent.dateTypes.CURRENT_MONTH||s===this.parent.dateTypes.CURRENT_QUARTER||s===this.parent.dateTypes.LAST_7_DAYS||s===this.parent.dateTypes.LAST_30_DAYS||s===this.parent.dateTypes.LAST_60_DAYS||s===this.parent.dateTypes.LAST_90_DAYS||s===this.parent.dateTypes.LAST_WEEK||s===this.parent.dateTypes.LAST_MONTH||s===this.parent.dateTypes.TOMORROW||s===this.parent.dateTypes.YESTERDAY||s===this.parent.dateTypes.NEXT_WEEK||s===this.parent.dateTypes.NEXT_MONTH){i=false}}if(e.TYPE===this.parent.types.NUMBER){if(BX.type.isPlainObject(e.VALUES)&&(e.VALUES._from||e.VALUES._to)){i=false}}if(e.TYPE===this.parent.types.CHECKBOX){if(BX.type.isPlainObject(e.VALUE)&&e.VALUE.VALUE){i=false}}return i}},{key:"resetPreset",value:function t(e){this.applyPreset("",e)}},{key:"getFields",value:function t(){var e=this.parent.getFieldListContainer();var i=null;if(BX.type.isDomNode(e)){i=BX.Filter.Utils.getBySelector(e.parentNode,".".concat(this.parent.settings.classFileldControlList," > div"),true)}return i}},{key:"getField",value:function t(e){var i=this.getFields();var s=null;var n;var a;if(BX.type.isArray(i)&&i.length){a=i.filter(function(t){if(BX.type.isDomNode(t)){n=BX.data(t,"name")}return n===e.NAME},this);s=a.length>0?a[0]:null}return s}},{key:"removeField",value:function t(e,i){var s;var n;i=i||false;if(BX.type.isPlainObject(e)){n=e.NAME;e=this.getField(e);if(BX.type.isArray(this.parent.fieldsList)){s=this.parent.fieldsList.indexOf(e);if(s!==-1){delete this.parent.fieldsList[s]}}this.parent.unregisterDragItem(e)}if(BX.type.isDomNode(e)){n=BX.data(e,"name");this.parent.getFields().deleteField(e)}if(!this.parent.isEditEnabled()&&!this.parent.isAddPresetEnabled()){var a=this.getCurrentPresetId();var r=this.getPresetField(a,n);if(r&&!this.isEmptyField(r)){this.deactivateAllPresets();this.parent.applyFilter()}}if(!i){this.parent.saveFieldsSort()}}},{key:"removeFields",value:function t(e){e.forEach(function(t){this.removeField(t,true)},this);this.parent.saveFieldsSort()}},{key:"addField",value:function t(e){var i;var s;var n;if(BX.type.isPlainObject(e)){i=this.parent.getFieldListContainer();n=this.parent.getControls();s=BX.type.isArray(n)?n[n.length-1]:null;if(BX.type.isDomNode(s)){if(s.nodeName!=="INPUT"){s=BX.Filter.Utils.getByTag(s,"input")}if(BX.type.isDomNode(s)){e.TABINDEX=parseInt(s.getAttribute("tabindex"))+1}}else{e.TABINDEX=2}if(BX.type.isDomNode(i)){s=this.createControl(e);if(BX.type.isDomNode(s)){BX.append(s,i);if(BX.type.isArray(this.parent.fieldsList)){this.parent.fieldsList.push(s)}this.parent.registerDragItem(s)}}}if(!this.parent.isEditEnabled()&&!this.parent.isAddPresetEnabled()){var a=this.getCurrentPresetId();var r=this.getPresetField(a,e.NAME);if(r&&!this.isEmptyField(r)){this.parent.updatePreset("tmp_filter");this.deactivateAllPresets();this.parent.getSearch().updatePreset(this.getPreset("tmp_filter"))}}this.parent.saveFieldsSort()}},{key:"createControl",value:function t(e){var i;switch(e.TYPE){case this.parent.types.STRING:{i=this.parent.getFields().createInputText(e);break}case this.parent.types.TEXTAREA:{i=this.parent.getFields().createTextarea(e);break}case this.parent.types.SELECT:{i=this.parent.getFields().createSelect(e);break}case this.parent.types.MULTI_SELECT:{i=this.parent.getFields().createMultiSelect(e);break}case this.parent.types.NUMBER:{i=this.parent.getFields().createNumber(e);break}case this.parent.types.DATE:{i=this.parent.getFields().createDate(e);break}case this.parent.types.CUSTOM_DATE:{i=this.parent.getFields().createCustomDate(e);break}case this.parent.types.DEST_SELECTOR:{i=this.parent.getFields().createDestSelector(e);break}case this.parent.types.CUSTOM:{i=this.parent.getFields().createCustom(e);break}case this.parent.types.CUSTOM_ENTITY:{i=this.parent.getFields().createCustomEntity(e);break}default:{break}}if(BX.type.isDomNode(i)){i.dataset.name=e.NAME;i.FieldController=new BX.Filter.FieldController(i,this.parent);if(e.REQUIRED){var s=i.querySelector(".main-ui-filter-field-delete");if(s){BX.remove(s)}}}return i}},{key:"removeNotCompareVariables",value:function t(e,i){if(BX.type.isPlainObject(e)){var s=this.parent.dateTypes;var n=this.parent.additionalDateTypes;if("FIND"in e){delete e.FIND}if(!i){Object.keys(e).forEach(function(t){if(t.indexOf("_numsel")!==-1){delete e[t]}if(t.indexOf("_datesel")!==-1){var i=e[t];if(i===s.EXACT||i===s.RANGE||i===n.PREV_DAY||i===n.NEXT_DAY||i===n.MORE_THAN_DAYS_AGO||i===n.AFTER_DAYS||i===s.PREV_DAYS||i===s.NEXT_DAYS||i===s.YEAR||i===s.MONTH||i===s.QUARTER||i===s.NONE||i===s.CUSTOM_DATE){delete e[t]}}var a=this.parent.getFieldByName(t);if(e[t]===""&&(!a||!a.STRICT)){delete e[t]}},this)}}}},{key:"isPresetValuesModified",value:function t(e){var i=this.getPreset(e);var s=this.parent.preparePresetSettingsFields(i.FIELDS);var n=this.parent.getFilterFieldsValues();this.removeNotCompareVariables(s);this.removeNotCompareVariables(n);var a=BX.Filter.Utils.sortObject(s);var r=BX.Filter.Utils.sortObject(n);return!Object.keys(a).every(function(t){return a[t]===r[t]||(BX.type.isPlainObject(a[t])||BX.type.isArray(a[t]))&&BX.Filter.Utils.objectsIsEquals(a[t],r[t])})}},{key:"getAdditionalValues",value:function t(e){var i=this.getPreset(e);var s=i.FIELDS.filter(function(t){return!this.isEmptyField(t)},this);var n=this.parent.preparePresetSettingsFields(s);var a=this.parent.getFilterFieldsValues();this.removeNotCompareVariables(n,true);this.removeNotCompareVariables(a,true);this.removeSameProperties(a,n);return a}},{key:"removeSameProperties",value:function t(e,i){if(BX.type.isPlainObject(e)&&BX.type.isPlainObject(i)){Object.keys(i).forEach(function(t){if(t in e){delete e[t]}})}}},{key:"removeAdditionalField",value:function t(e){var i=this.getPreset(this.getCurrentPresetId());if(BX.type.isArray(i.ADDITIONAL)){i.ADDITIONAL=i.ADDITIONAL.filter(function(t){return t.NAME!==e})}}},{key:"updatePresetFields",value:function t(e,i){var s;var n;var a=[];if(BX.type.isPlainObject(e)&&"FIELDS"in e){s=e.FIELDS;if(BX.type.isArray(e.ADDITIONAL)){e.ADDITIONAL.forEach(function(t){var e=false;t.IS_PRESET_FIELD=true;s.forEach(function(i,n){if(t.NAME===i.NAME){s[n]=t;e=true}});if(!e){s.push(t)}})}(s||[]).forEach(function(t,e){t.TABINDEX=e+1;if(i){switch(t.TYPE){case this.parent.types.SELECT:{t.VALUE=t.ITEMS[0];break}case this.parent.types.MULTI_SELECT:{t.VALUE=[];break}case this.parent.types.DATE:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:"",_days:""};break}case this.parent.types.CUSTOM_DATE:{t.VALUE={days:[],months:[],years:[]};break}case this.parent.types.NUMBER:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:""};break}case this.parent.types.CUSTOM_ENTITY:{t.VALUES={_label:"",_value:""};break}case this.parent.types.CUSTOM:{t._VALUE="";break}default:{if("VALUE"in t){if(BX.type.isArray(t.VALUE)){t.VALUE=[]}else{t.VALUE=""}}break}}}a.push(this.createControl(t))},this);this.parent.disableFieldsDragAndDrop();n=this.parent.getFieldListContainer();BX.cleanNode(n);if(a.length){a.forEach(function(t,i){if(BX.type.isDomNode(t)){if(e.ID!=="tmp_filter"&&e.ID!=="default_filter"&&!("IS_PRESET_FIELD"in s[i])&&!this.isEmptyField(s[i])){BX.addClass(t,this.parent.settings.classPresetField)}BX.append(t,n);if(BX.type.isString(s[i].HTML)){var a=BX.create("div");this.parent.getHiddenElement().appendChild(a);BX.html(a,s[i].HTML)}}},this);this.parent.enableFieldsDragAndDrop()}}}},{key:"showCurrentPresetFields",value:function t(){var e=this.getCurrentPresetData();this.updatePresetFields(e)}},{key:"getCurrentPreset",value:function t(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPresetCurrent)}},{key:"getCurrentPresetId",value:function t(){var e=this.getCurrentPreset();var i=null;if(BX.type.isDomNode(e)){i=this.getPresetId(e)}else{i="tmp_filter"}return i}},{key:"getCurrentPresetData",value:function t(){var e=this.getCurrentPresetId();var i=null;if(BX.type.isNotEmptyString(e)){i=this.getPreset(e);i=this.extendPreset(i)}return i}},{key:"getContainer",value:function t(){return BX.Filter.Utils.getByClass(this.parent.getFilter(),this.parent.settings.classPresetsContainer)}},{key:"getPresets",value:function t(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPreset,true)}},{key:"getDefaultPresets",value:function t(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classDefaultFilter,true)}},{key:"getPinnedPresetNode",value:function t(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPinnedPreset)}},{key:"isPinned",value:function t(e){return this.getPinnedPresetId()===e}},{key:"getPinnedPresetId",value:function t(){var e=this.getPinnedPresetNode();var i="default_filter";if(e){var s=BX.data(e,"id");i=s||i}return i}}]);return t}();t.Field=s;t.Api=n;t.Fields=d;t.Presets=p})(this.BX.Filter=this.BX.Filter||{},BX);
//# sourceMappingURL=script.map.js